<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>cliff&#39;s personal blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="cliff&#39;s personal blog">
<meta property="og:url" content="https://cliff0412.github.io/index.html">
<meta property="og:site_name" content="cliff&#39;s personal blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="cliff">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="cliff's personal blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">cliff&#39;s personal blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://cliff0412.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-math/polynomials" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/06/13/math/polynomials/" class="article-date">
  <time class="dt-published" datetime="2024-06-13T03:13:17.000Z" itemprop="datePublished">2024-06-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/06/13/math/polynomials/">polynomials</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <script
 src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"
  type="text/javascript">
</script>

<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Let \(A(X)\) be a polynomial over \(\mathbb{F}_p\) with formal indeterminate \(X\). As an example,</p>
<p>$$<br>A(X) &#x3D; a_0 + a_1 X + a_2 X^2 + a_3 X^3<br>$$</p>
<p>defines a degree-\(3\) polynomial. \(a_0\) is referred to as the constant term. Polynomials of<br>degree \(n-1\) have \(n\) coefficients.</p>
<h4 id="aside-Horner’s-rule"><a href="#aside-Horner’s-rule" class="headerlink" title="(aside) Horner’s rule"></a>(aside) Horner’s rule</h4><blockquote>
<p>Horner’s rule allows for efficient evaluation of a polynomial of degree \(n-1\), using<br>only \(n-1\) multiplications and \(n-1\) additions. It is the following identity:<br>$$\begin{aligned}a_0 &amp;+ a_1X + a_2X^2 + \cdots + a_{n-1}X^{n-1} \ &amp;&#x3D; a_0 + X\bigg( a_1 + X \Big( a_2 + \cdots + X(a_{n-2} + X a_{n-1}) \Big)!\bigg),\end{aligned}$$</p>
</blockquote>
<h2 id="Quotient-Poly"><a href="#Quotient-Poly" class="headerlink" title="Quotient Poly"></a>Quotient Poly</h2><ol>
<li>divide the evaluation in each point &amp; use iFFT to get the poly coefficients</li>
<li>or, could use <a href="!https://en.wikipedia.org/wiki/Polynomial_long_division">polynomial long division</a></li>
</ol>
<h2 id="The-Schwartz-Zippel-lemma"><a href="#The-Schwartz-Zippel-lemma" class="headerlink" title="The Schwartz-Zippel lemma"></a>The Schwartz-Zippel lemma</h2><p>The Schwartz-Zippel lemma informally states that “different polynomials are different at<br>most points.” Formally, it can be written as follows:</p>
<blockquote>
<p>Let \(p(x_1, x_2, \cdots, x_n)\) be a nonzero polynomial of \(n\) variables with degree \(d\).<br>Let \(S\) be a finite set of numbers with at least \(d\) elements in it. If we choose random<br>\(\alpha_1, \alpha_2, \cdots, \alpha_n<br>\) from \(S\),<br>$$\text{Pr}[p(\alpha_1, \alpha_2, \cdots, \alpha_n) &#x3D; 0] \leq \frac{d}{|S|}.$$</p>
</blockquote>
<p>In the familiar univariate case \(p(X)\), this reduces to saying that a nonzero polynomial<br>of degree \(d\) has at most \(d\) roots.</p>
<p>The Schwartz-Zippel lemma is used in polynomial equality testing.  Given two multi-variate<br>polynomials \(p_1(x_1,\cdots,x_n)\) and \(p_2(x_1,\cdots,x_n)\) of degrees \(d_1, d_2\)<br>respectively, we can test if<br>\(p_1(\alpha_1, \cdots, \alpha_n) - p_2(\alpha_1, \cdots, \alpha_n) &#x3D; 0\) for random<br>\(\alpha_1, \cdots, \alpha_n \leftarrow S,\) where the size of \(S\) is at least<br>\(|S| \geq (d_1 + d_2).\)  If the two polynomials are identical, this will always be true,<br>whereas if the two polynomials are different then the equality holds with probability at<br>most \(\frac{\max(d_1,d_2)}{|S|}\).</p>
<h2 id="Vanishing-polynomial"><a href="#Vanishing-polynomial" class="headerlink" title="Vanishing polynomial"></a>Vanishing polynomial</h2><p>Consider the order-\(n\) multiplicative subgroup \(\mathcal{H}\) with primitive root of unity<br>\(\omega\). For all \(\omega^i \in \mathcal{H}, i \in [n-1],\) we have<br>\((\omega^i)^n &#x3D; (\omega^n)^i &#x3D; (\omega^0)^i &#x3D; 1.\) In other words, every element of<br>\(\mathcal{H}\) fulfils the equation </p>
<p>$$<br>\begin{aligned}<br>Z_H(X) &amp;&#x3D; X^n - 1 \<br>&amp;&#x3D; (X-\omega^0)(X-\omega^1)(X-\omega^2)\cdots(X-\omega^{n-1}),<br>\end{aligned}<br>$$</p>
<p>meaning every element is a root of \(Z_H(X).\) We call \(Z_H(X)\) the <strong>vanishing polynomial</strong><br>over \(\mathcal{H}\) because it evaluates to zero on all elements of \(\mathcal{H}.\)</p>
<p>This comes in particularly handy when checking polynomial constraints. For instance, to<br>check that \(A(X) + B(X) &#x3D; C(X)\) over \(\mathcal{H},\) we simply have to check that<br>\(A(X) + B(X) - C(X)\) is some multiple of \(Z_H(X)\). In other words, if dividing our<br>constraint by the vanishing polynomial still yields some polynomial<br>\(\frac{A(X) + B(X) - C(X)}{Z_H(X)} &#x3D; H(X),\) we are satisfied that \(A(X) + B(X) - C(X) &#x3D; 0\)<br>over \(\mathcal{H}.\)</p>
<h2 id="Lagrange-basis-functions"><a href="#Lagrange-basis-functions" class="headerlink" title="Lagrange basis functions"></a>Lagrange basis functions</h2><p>Polynomials are commonly written in the monomial basis (e.g. \(X, X^2, … X^n)\). However,<br>when working over a multiplicative subgroup of order \(n\), we find a more natural expression<br>in the Lagrange basis.</p>
<p>Consider the order-\(n\) multiplicative subgroup \(\mathcal{H}\) with primitive root of unity<br>\(\omega\). The Lagrange basis corresponding to this subgroup is a set of functions<br>\(\mathcal{L_i}_{i &#x3D; 0}^{n-1}\)<br>where </p>
<p>$$<br>\mathcal{L_i}(\omega^j) &#x3D; \begin{cases}<br>1 &amp; \text{if } i &#x3D; j, \<br>0 &amp; \text{otherwise.}<br>\end{cases}<br>$$</p>
<p>We can write this more compactly as \(\mathcal{L_i}(\omega^j) &#x3D; \delta_{ij},\) where<br>\(\delta\) is the Kronecker delta function. </p>
<p>Now, we can write our polynomial as a linear combination of Lagrange basis functions,</p>
<p>$$A(X) &#x3D; \sum_{i &#x3D; 0}^{n-1} a_i\mathcal{L_i}(X), X \in \mathcal{H},$$</p>
<p>which is equivalent to saying that \(A(X)\) evaluates to \(a_0\) at \(\omega^0\),<br>to \(a_1\) at \(\omega^1\), to \(a_2\) at \(\omega^2, \cdots,\) and so on.</p>
<p>When working over a multiplicative subgroup, the Lagrange basis function has a convenient<br>sparse representation of the form</p>
<p>$$<br>\mathcal{L}_i(X) &#x3D; \frac{c_i\cdot(X^{n} - 1)}{X - \omega^i},<br>$$</p>
<p>where \(c_i\) is the barycentric weight. (To understand how this form was derived, refer to<br>[^barycentric].) For \(i &#x3D; 0,\) we have<br>\(c &#x3D; 1&#x2F;n \implies \mathcal{L}_0(X) &#x3D; \frac{1}{n} \frac{(X^{n} - 1)}{X - 1}\).</p>
<p>Suppose we are given a set of evaluation points \({x_0, x_1, \cdots, x_{n-1}}\).<br>Since we cannot assume that the \(x_i\)’s form a multiplicative subgroup, we consider also<br>the Lagrange polynomials \(\mathcal{L}_i\)’s in the general case. Then we can construct:</p>
<p>$$<br>\mathcal{L}<em>i(X) &#x3D; \prod</em>{j\neq i}\frac{X - x_j}{x_i - x_j}, i \in [0..n-1].<br>$$</p>
<p>Here, every \(X &#x3D; x_j \neq x_i\) will produce a zero numerator term \((x_j - x_j),\) causing<br>the whole product to evaluate to zero. On the other hand, \(X&#x3D; x_i\) will evaluate to<br>\(\frac{x_i - x_j}{x_i - x_j}\) at every term, resulting in an overall product of one. This<br>gives the desired Kronecker delta behaviour \(\mathcal{L_i}(x_j) &#x3D; \delta_{ij}\) on the<br>set \({x_0, x_1, \cdots, x_{n-1}}\).</p>
<h3 id="Lagrange-interpolation"><a href="#Lagrange-interpolation" class="headerlink" title="Lagrange interpolation"></a>Lagrange interpolation</h3><p>Given a polynomial in its evaluation representation</p>
<p>$$A: {(x_0, A(x_0)), (x_1, A(x_1)), \cdots, (x_{n-1}, A(x_{n-1}))},$$</p>
<p>we can reconstruct its coefficient form in the Lagrange basis:</p>
<p>$$A(X) &#x3D; \sum_{i &#x3D; 0}^{n-1} A(x_i)\mathcal{L_i}(X), $$</p>
<p>where \(X \in {x_0, x_1,\cdots, x_{n-1}}.\)</p>
<h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><ul>
<li>[1] <a target="_blank" rel="noopener" href="https://zcash.github.io/halo2/background/polynomials.html">halo2 book</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2024/06/13/math/polynomials/" data-id="clxd1usfc0001io7u6td60hz5" data-title="polynomials" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/math/" rel="tag">math</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-arithmatic/multiplications" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/16/arithmatic/multiplications/" class="article-date">
  <time class="dt-published" datetime="2024-01-16T11:11:20.323Z" itemprop="datePublished">2024-01-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Karatsuba-algorithm"><a href="#Karatsuba-algorithm" class="headerlink" title="Karatsuba algorithm"></a>Karatsuba algorithm</h2><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Karatsuba_algorithm#Implementation">https://en.wikipedia.org/wiki/Karatsuba_algorithm#Implementation</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2024/01/16/arithmatic/multiplications/" data-id="clxd1usf80000io7ufsqy3fi7" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-math/multi-scalar-multiplication" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/08/math/multi-scalar-multiplication/" class="article-date">
  <time class="dt-published" datetime="2024-01-08T03:13:17.000Z" itemprop="datePublished">2024-01-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/08/math/multi-scalar-multiplication/">multi scalar multiplication (MSM)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript">
</script>

<h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>Let \( \mathbb{G}\) be a group of order \(p&#x3D;2^{\lambda}\)(\(\lambda\) would be the number of bits of the prime).  Give \(n\) scalars \(e_i\) and \(n\) EC points \(P_i\), calculate \(P\) such that<br>\[ P &#x3D; \sum_{i&#x3D;0}^{n}e_i P_i \]</p>
<h2 id="naive-approach"><a href="#naive-approach" class="headerlink" title="naive approach"></a>naive approach</h2><p>Let \(e_i &#x3D; e_{i,\lambda -1} e_{i,\lambda -2} …e_{i,0} \), where each \(e_{i,j} \in 0,1\).<br>We have<br>\[ e_i &#x3D; e_{i,\lambda-1}\cdot2^{\lambda-1} + e_{i, \lambda-2}\cdot2^{\lambda-2} + …+e_{i,0}\cdot2^0\]<br>To compute \(e_i \cdot p_i\), we can compute \(2^0 \cdot p_i,2^1 \cdot p_i,…,2^{\lambda-1} \cdot p_i  \). Then, we simply add them up to get \(e_i \cdot p_i\). Here, we need \(\lambda -1\) squarings (multiplication by 2) and \(\lambda-1\) additions.<br>To computing \(e_1\cdot p_1, e_2 \cdot p_2, …, e_{N-1}\cdot p_{N-1}\), we need \(N\cdot(\lambda-1)\) squarings and \(N\cdot(\lambda-1)\) additions.</p>
<p>We additionally need \(N-1\) additions to sum \(e_i\cdot p_i\) into \(P\).<br>In total, weed \(N\cdot(\lambda-1)\) squarings and \(N\cdot\lambda&#x3D;1\) additions</p>
<h2 id="pippenger-approach"><a href="#pippenger-approach" class="headerlink" title="pippenger approach"></a>pippenger approach</h2><p>at a high level, Pippenger approach divides \(\lambda\) bits into <code>num_window</code> (\(&#x3D;\frac{\lambda}{c}\)) bit windows where each bit window has \(c\) bits. \(c\) is also called “window size”.</p>
<h3 id="Part-I-computation-for-each-window"><a href="#Part-I-computation-for-each-window" class="headerlink" title="Part I (computation for each window)"></a>Part I (computation for each window)</h3><p>Initialize a vector <code>window_res = [0,0,...,0]</code> of length <code>num_window</code>.<br>For the w-th window:</p>
<ul>
<li>Initialize a vector <code>buckets=[0,0,...,0]</code> of length <code>num_buckets</code> &#x3D; \( 2^c -1 \).</li>
<li>Get the <code>start_idx</code> of the current window, say \(M\). Remember that we are considering a <code>c-bit</code> window out of \(\lambda\)-bit fields</li>
<li>for each pair of \((e_i, g_i)\)<ul>
<li>Get the bits in scalar \(e_i\) correspondign to the current window. Formally, we have <code>scalar</code> &#x3D; \((e_i &gt;&gt; M) \mod 2^c\).</li>
<li>If <code>scalar</code> \(\ne 0\), we have buckets[scalar-1] +&#x3D; \(p_i\)</li>
</ul>
</li>
<li>Initialize <code>tmp = 0</code></li>
<li>For <code>j</code> in \(2^c-1\) to 1:<br><code>tmp= tmp+buckets[j]</code></li>
<li><code>window_res[w] = tmp</code></li>
</ul>
<h3 id="Part-II-sum-over-all-windows"><a href="#Part-II-sum-over-all-windows" class="headerlink" title="Part II (sum over all windows)"></a>Part II (sum over all windows)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lowest = window_res[0]</span><br><span class="line">total = 0</span><br><span class="line">for w in num_window -1 to 1:</span><br><span class="line">  total += window_res[w]</span><br><span class="line">  for _ in 0..c:</span><br><span class="line">    total = total + total // shift left c bits.</span><br><span class="line">total = total + lowest</span><br></pre></td></tr></table></figure>
<p><code>total</code> is the final result</p>
<p>In Part I, for each window, we need \(N+2^c\) additions. Since we have \(\frac{\lambda}{c}\) windows, we need \((N+2^{\lambda}*\frac{\lambda}{c})\) additions.</p>
<p>In Part II, we need 1 addition and <code>c</code> squarings for each window.<br>In total, we need \(\frac{\lambda}{c}\cdot(N+2^c+1)\) additions and \(\lambda\) squarings.</p>
<p>In Arkworks implementation, <code>c</code> is set to be \(ln(N)+2\).<br>For notation simplicity, let’s set <code>c</code> to be \(log2(N)\). Then, the computation complexity of Pippenger’s algorithm is \(\frac{2N\lambda}{log2(N)}+1\) additions and \(\lambda\) squarings<br>Since \(\lambda\) is a constant for a elliptic curve, people usually say that pippenger has a time complexity of \(O(\frac{N}{log(N)})\)</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://hackmd.io/@drouyang/SyYwhWIso">pippenger MSM</a></li>
<li><a target="_blank" rel="noopener" href="https://hackmd.io/@tazAymRSQCGXTUKkbh1BAg/Sk27liTW9">MSM</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2024/01/08/math/multi-scalar-multiplication/" data-id="clqvsqlmv0001r47uaciz8xrp" data-title="multi scalar multiplication (MSM)" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/math/" rel="tag">math</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-rust/rust_analyzer" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/01/rust/rust_analyzer/" class="article-date">
  <time class="dt-published" datetime="2024-01-01T09:14:05.000Z" itemprop="datePublished">2024-01-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/01/rust/rust_analyzer/">rust analyzer</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="config"><a href="#config" class="headerlink" title="config"></a>config</h2><p>under <code>.vscode/settings.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">&quot;rust-analyzer.linkedProjects&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">	<span class="string">&quot;$&#123;path_to_toml.file&quot;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2024/01/01/rust/rust_analyzer/" data-id="clqvsqlmv0000r47ufd56e3qu" data-title="rust analyzer" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rust/" rel="tag">rust</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-cpp/build" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/12/20/cpp/build/" class="article-date">
  <time class="dt-published" datetime="2023-12-20T03:35:20.000Z" itemprop="datePublished">2023-12-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/12/20/cpp/build/">cpp build</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="cmake"><a href="#cmake" class="headerlink" title="cmake"></a>cmake</h2><h3 id="environment-variables"><a href="#environment-variables" class="headerlink" title="environment variables"></a>environment variables</h3><ul>
<li>CMAKE_SOURCE_DIR: the root directory of the source tree for the project. This variable holds the full path to the directory where the top-level CMakeLists.txt file is located.</li>
</ul>
<h3 id="cuda-related"><a href="#cuda-related" class="headerlink" title="cuda related"></a>cuda related</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="system-config"><a href="#system-config" class="headerlink" title="system config"></a>system config</h2><ul>
<li><code>/etc/ld.so.conf</code><br>The file &#x2F;etc&#x2F;ld.so.conf is a configuration file used by the dynamic linker&#x2F;loader on Unix-like systems, including Linux. Its purpose is to specify additional directories where the linker should search for shared libraries at runtime.<br>When a program starts, the dynamic linker&#x2F;loader is responsible for resolving and loading shared libraries (also known as dynamic libraries or shared objects). The paths specified in &#x2F;etc&#x2F;ld.so.conf help the linker locate these libraries.<br>On some systems, you might also find additional configuration files in the <code>/etc/ld.so.conf.d/</code> directory, each containing a list of directories.<br>After modifying the file, you need to run the <code>ldconfig</code> command to update the dynamic linker’s cache and apply the changes.</li>
</ul>
<p><strong>note</strong>: <code>ld</code> stands for linker</p>
<h2 id="tools"><a href="#tools" class="headerlink" title="tools"></a>tools</h2><h3 id="nm"><a href="#nm" class="headerlink" title="nm"></a>nm</h3><p>nm is a command-line utility on Unix-like operating systems that displays information about the symbols (e.g., functions, variables) contained in object files, executables, and shared libraries. The name “nm” stands for “name list.”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nm -D $&#123;path_to_dynamic_library&#125;</span><br></pre></td></tr></table></figure>
<p>The default information that the ‘nm’ command provides is :</p>
<ul>
<li>Virtual address of the symbol</li>
<li>A character which depicts the symbol type. If the character is in lower case then the symbol is local but if the character is in upper case then the symbol is external</li>
<li>Name of the symbol</li>
</ul>
<p>The characters that identify symbol type describe :</p>
<ul>
<li>A :  Global absolute symbol.</li>
<li>a  :  Local absolute symbol.</li>
<li>B : Global bss symbol.</li>
<li>b : Local bss symbol.</li>
<li>D : Global data symbol.</li>
<li>d : Local data symbol.</li>
<li>f : Source file name symbol.</li>
<li>L : Global thread-local symbol (TLS).</li>
<li>l : Static thread-local symbol (TLS).</li>
<li>T : Global text symbol.</li>
<li>t  : Local text symbol.</li>
<li>U : Undefined symbol.</li>
</ul>
<h3 id="objdump"><a href="#objdump" class="headerlink" title="objdump"></a>objdump</h3><h2 id="environment-variables-1"><a href="#environment-variables-1" class="headerlink" title="environment variables"></a>environment variables</h2><ul>
<li><code>LD_LIBRARY_PATH</code><br>The <code>LD_LIBRARY_PATH</code> environment variable is used in Unix-like operating systems (including Linux) to specify a list of directories where the system should look for shared libraries before searching the default system locations. This variable is particularly useful when you want to run an executable that depends on shared libraries that are not in standard library paths.</li>
</ul>
<ol>
<li>compiling<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -o my_program my_program.cpp -lmy_library -L/path/to/library</span><br></pre></td></tr></table></figure></li>
<li>running<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=/path/to/library:$LD_LIBRARY_PATH</span><br><span class="line">./my_program</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/12/20/cpp/build/" data-id="clqg03z8h0000hr7ua19bg4xa" data-title="cpp build" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cpp/" rel="tag">cpp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-cryptography/field/field" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/12/15/cryptography/field/field/" class="article-date">
  <time class="dt-published" datetime="2023-12-15T03:19:44.000Z" itemprop="datePublished">2023-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/12/15/cryptography/field/field/">field</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript">
</script>

<h2 id="Pseudo-Mersenne-Prime"><a href="#Pseudo-Mersenne-Prime" class="headerlink" title="Pseudo-Mersenne Prime"></a>Pseudo-Mersenne Prime</h2><p>Pseudo-Mersenne Prime is a prime of the form<br>\[ p &#x3D; 2^m -k \]<br>where \(k\) is an integer for which<br>\[ 0 \lt |k| \lt 2^{\lfloor m&#x2F;2 \rfloor} \]</p>
<p>if \(k&#x3D;1\), then \(p\) is a <strong>Mersenne prime</strong> (and \(m\) must necesarily be a priime). if \(k&#x3D;-1\); then \(p\) is called a <strong>Fermat prime</strong> (and \(m\) must necessarily be a power of two)</p>
<p>Pseudo-Mersenne primes are useful in public-key cryptography because they admit fast modular reduction similar to Mersenne primes. If \(n\) is a positive integer less than \(p^2\), then \(n\) can be written as<br>\[ n &#x3D; u \cdot 2^{2m} + a \cdot 2^{m} + b \]<br>where \(u&#x3D;0\) or \(1\) and \(a\) and \(b\) are nonnegative integers less than \(2^m\). Then<br>\[ n \equiv u \cdot k^2 + a \cdot k + b \mod p\]</p>
<p>Repeating this substitution a few times will yield \(n \mod p\).</p>
<h2 id="Optimal-Extension-Fields-OEF"><a href="#Optimal-Extension-Fields-OEF" class="headerlink" title="Optimal Extension Fields (OEF)"></a>Optimal Extension Fields (OEF)</h2><p>Optimal extension fields (OEFs) are a family of finite fields with an arithmetic that can be implemented efficiently in software. OEFs are extension fields \(GP(p^m)\) where the prime p is of special form.</p>
<p>An Optimal Extension Field is a finite field \(GF(p^m)\) such that</p>
<ol>
<li>\(p\) is pseudo Mersenne prime</li>
<li>An irreducible binomial \(P(x) &#x3D; x^m - \omega\) exists over \(GF(p)\)</li>
</ol>
<h2 id="other-concepts"><a href="#other-concepts" class="headerlink" title="other concepts"></a>other concepts</h2><h3 id="two-adicity"><a href="#two-adicity" class="headerlink" title="two adicity"></a>two adicity</h3><p>A two-adicity of 32 means that there’s a multiplicative subgroup of size \(2^32\) that exists in the field.<br>For example</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TWO_ADICITY: <span class="type">u32</span> = <span class="number">32</span>;</span><br><span class="line"><span class="keyword">const</span> TWO_ADIC_ROOT_OF_UNITY: BigInteger = <span class="title function_ invoke__">BigInteger</span>([</span><br><span class="line">    <span class="number">0x218077428c9942de</span>, <span class="number">0xcc49578921b60494</span>, <span class="number">0xac2e5d27b2efbee2</span>, <span class="number">0xb79fa897f2db056</span></span><br><span class="line">]);  <span class="comment">// TWO_ADIC_ROOT_OF_UNITY^&#123;2^32&#125; = 1</span></span><br></pre></td></tr></table></figure>


<h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><ul>
<li><a target="_blank" rel="noopener" href="https://link.springer.com/referenceworkentry/10.1007/978-1-4419-5906-5_42">Pseudo-Mersenne Prime</a></li>
<li>[Optimal Extension Field] Bailey DV, Paar C (1998) Optimal extension fields for fast arithmetic in public-key algorithms. In: Krawczyk H (ed), Advances in cryptology–CRYPTO ’98, LNCS 1462. Springer, Berlin, pp 472–485</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/12/15/cryptography/field/field/" data-id="clq62f5h00000o97u98q7hrno" data-title="field" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cryptography/" rel="tag">cryptography</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/field/" rel="tag">field</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-cryptography/zkp/polygon_zkevm" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/12/11/cryptography/zkp/polygon_zkevm/" class="article-date">
  <time class="dt-published" datetime="2023-12-11T05:24:03.000Z" itemprop="datePublished">2023-12-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/12/11/cryptography/zkp/polygon_zkevm/">polygon zkEVM</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript">
</script>

<h2 id="zkProver"><a href="#zkProver" class="headerlink" title="zkProver"></a>zkProver</h2><h3 id="State-Machines"><a href="#State-Machines" class="headerlink" title="State Machines"></a>State Machines</h3><p>The zkProver follows modularity of design to the extent that, except for a few components, it is mainly a cluster of State Machines. It has a total of thirteen (13) State Machines;</p>
<ul>
<li>The Main State Machine</li>
<li>Secondary State Machines → Binary SM, Storage SM, Memory SM, Arithmetic SM, Keccak Function SM, PoseidonG SM,</li>
<li>Auxiliary State Machines → Padding-PG SM, Padding-KK SM, Bits2Field SM, Memory Align SM, Byte4 SM, ROM SM.<br>Due to the modular design of zkProver, the Main State Machine can delegate as many of tasks as possible to other specialist State Machines. This heavily improves the efficiency of Main SM.<br><img src="/images/zkp/zkevm/polygon/state_machines.png"></li>
</ul>
<h3 id="Two-Novel-Languages-For-zkProver"><a href="#Two-Novel-Languages-For-zkProver" class="headerlink" title="Two Novel Languages For zkProver"></a>Two Novel Languages For zkProver</h3><h4 id="Zero-Knowledge-Assembly-zkASM"><a href="#Zero-Knowledge-Assembly-zkASM" class="headerlink" title="Zero-Knowledge Assembly(zkASM)"></a>Zero-Knowledge Assembly(zkASM)</h4><p>As an Assembly language, the Zero-Knowledge Assembly (or zkASM) language is specially designed to map instructions from the zkProver’s Main State Machine to other State Machines. In case of the State Machines with firmware, zkASM is the Interpreter for the firmware.</p>
<h4 id="Polynomial-Identity-Language-PIL"><a href="#Polynomial-Identity-Language-PIL" class="headerlink" title="Polynomial Identity Language(PIL)"></a>Polynomial Identity Language(PIL)</h4><p>The Polynomial Identity Language (or PIL) is especially designed for the zkProver. Almost all state machines express computations in terms of polynomials. Therefore, state transitions in State Machines must satisfy computation-specific polynomial identities.</p>
<h3 id="Microprocessor-State-Machines"><a href="#Microprocessor-State-Machines" class="headerlink" title="Microprocessor State Machines"></a>Microprocessor State Machines</h3><p>There are two microprocessor-type state machines; the Main SM and the Storage SM. These two State Machines have the Firmware and the Hardware part. It is worth noting that each of these Microprocessor SM has its own ROM.</p>
<p>The Firmware part runs the zkASM language to set up the logic and rules, which are expressed in JSON format and stored in a ROM. The JSON-file is then parsed to the specific SM Executor, which executes Storage Actions in compliance with the rules and logic in the JSON-file.</p>
<p>The Hardware component, which uses the Polynomial Identity Language (PIL), defines constraints (or polynomial identities), expresses them in JSON format, and stores them in the accompanying JSON-file. These constraints are parsed to the specific SM Executor, because all computations must be executed in conformance to the polynomial identities.</p>
<p><img src="/images/zkp/zkevm/polygon/micro_processor.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/12/11/cryptography/zkp/polygon_zkevm/" data-id="clq0nd00w00024z7u843t2waw" data-title="polygon zkEVM" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cryptography/" rel="tag">cryptography</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zkp/" rel="tag">zkp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-arithmatic/montgomery-multiplication" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/12/07/arithmatic/montgomery-multiplication/" class="article-date">
  <time class="dt-published" datetime="2023-12-07T11:10:13.000Z" itemprop="datePublished">2023-12-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/12/07/arithmatic/montgomery-multiplication/">montgomery multiplication</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript">
</script>

<h2 id="montgomery-space"><a href="#montgomery-space" class="headerlink" title="montgomery space"></a>montgomery space</h2><p>Montgomery multiplication works by first transforming the multipliers into Montgomery space, where modular multiplication can be performed cheaply, and then transforming them back when their actual values are needed. Unlike general integer division methods, Montgomery multiplication is not efficient for performing just one modular reduction and only becomes worthwhile when there is a chain of modular operations. </p>
<p>The space is defined by the modulo <code>n</code> and a positive integer <code>r ≥ n</code> coprime to <code>n</code>. The algorithm involves modulo and division by <code>r</code>, so in practice, <code>r</code> is chosen to be <code>2^32</code> or <code>2^64</code>, so that these operations can be done with a right-shift and a bitwise <code>AND</code> respectively.</p>
<p>Definition. the representative \(\bar{x}\) of a number \(x\) in the Montgomery space is defined as<br>\[ \bar{x} &#x3D; x \cdot r \mod n \]</p>
<p>Computing this transformation involves a multiplication and a modulo — an expensive operation that we wanted to optimize away in the first place — which is why we only use this method when the overhead of transforming numbers to and from the Montgomery space is worth it and not for general modular multiplication.</p>
<p>Inside the Montgomery space, addition, substraction, and checking for equality is performed as usual:</p>
<p>\[ x \cdot r + y \cdot r \equiv (x+y) \cdot r \mod n \]</p>
<p>However, this is not the case for multiplication. Denoting multiplication in the Montgomery space as \(∗\) and the “normal” multiplication as \(\cdot\), we expect the result to be:<br>\[ \bar{x} * \bar{y} &#x3D; \overline{x\cdot y} &#x3D; (x\cdot y)\cdot r \mod n \]</p>
<p>But the normal multiplication in the Montgomery space yields:<br>\[ \bar{x} \cdot \bar{y}&#x3D;(x\cdot y)\cdot r \cdot r \mod n  \]</p>
<p>Therefore, the multiplication in the Montgomery space is defined as<br>\[ \bar{x} * \bar{y} &#x3D; \bar{x} \cdot \bar{y} \cdot r^{-1} \mod n \]</p>
<p>This means that, after we normally multiply two numbers in the Montgomery space, we need to reduce the result by multiplying it by \(r^{-1}\)  and taking the modulo — and there is an efficent way to do this particular operation.</p>
<h2 id="Montgomery-reduction"><a href="#Montgomery-reduction" class="headerlink" title="Montgomery reduction"></a>Montgomery reduction</h2><p>assume that \(r&#x3D;2^{32}\), the modulo \(n\) is 32-bit, and the number \(x\) we need to reduce is 64-bit(the product of two 32-bit numbers). The goal is to calculate \(y&#x3D;x\cdot r^{-1} \mod n\).</p>
<p>Since \(r\) is coprime with \(n\), we know that there are two numbers \(r^{-1}\) and \(n’\) in the \([0, n)\) range such that<br>\[ r \cdot r^{-1} + n \cdot n’ &#x3D; 1 \]<br>both \(r^{-1} and \quad n’\) can be computed using extended Euclidean algorithm <strong>(\(n’ &#x3D; n^{-1} \mod r\))</strong>.<br>Using this identiy, we can express \(r \cdot r^{-1}\) as \(1-n\cdot n’\) and write \(x \cdot r^{-1}\) as</p>
<p>\[<br>  \displaylines{<br>  x\cdot r^{-1} &#x3D; \frac{x \cdot r \cdot r^{-1}}{r} \\<br>  &#x3D; \frac{x \cdot (1-n\cdot n’)}{r} \\<br>  &#x3D; \frac{x - x \cdot n \cdot n’}{r} \\<br>  &#x3D; \frac{x - x \cdot n \cdot n’ + k\cdot r \cdot n}{r} \quad (\mod n) (for \hspace{0.2cm}any\hspace{0.2cm} integer\hspace{0.2cm} k) \\<br>  &#x3D; \frac{x - (x\cdot n’ - k\cdot r)\cdot n}{r}<br>}<br>  \]</p>
<p>Now, if we choose \(k\) to be \(\lfloor x\cdot n’&#x2F;r\rfloor\) (the upper 64 bits of \(x\cdot n’\), giving \(x\) is 64 bits and \(n’\) is 32 bits ), it will cancel out, and \(k\cdot r - x\cdot n’\) will simply be equal to \(x \cdot n’ \mod r\) (the lower 32 bits of \(x\cdot n’\)), implying:<br>\[ x\cdot r^{-1} &#x3D; (x - (x\cdot n’ \mod r )\cdot n)&#x2F;r\]</p>
<p>the algorithm itself just evaluates this formula, performing two multiplications to calculate \(q &#x3D; x\cdot n’ \mod r\) and \(m &#x3D; q\cdot n\), and then subtracts it from \(x\) and right shifts the result to divide it by r.</p>
<p>The only remaining thing to handle is that the result may not be in the \([0,n)\) range; but since<br>\[x &lt; n\cdot n &lt; r\cdot n &#x3D;&gt; x&#x2F;r &lt; n \]<br>and<br>\[m &#x3D; q\cdot n &lt; r\cdot n &#x3D;&gt; m&#x2F;r &lt; n\]<br>it is guaranted that<br>\[ -n &lt; (x-m)&#x2F;r &lt; n \]</p>
<p>Therefore, we can simply check if the result is negative and in that case, add \(n\) to it, giving the following algorithm:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">__uint32_t</span> u32;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">__uint64_t</span> u64;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> u32 n = <span class="number">1e9</span> + <span class="number">7</span>, nr = <span class="built_in">inverse</span>(n, <span class="number">1ull</span> &lt;&lt; <span class="number">32</span>); <span class="comment">// nr is n&#x27; in the above equations, r is 1&lt;&lt;32</span></span><br><span class="line"></span><br><span class="line"><span class="function">u32 <span class="title">reduce</span><span class="params">(u64 x)</span> </span>&#123;</span><br><span class="line">    u32 q = <span class="built_in">u32</span>(x) * nr;      <span class="comment">// q = x * n&#x27; mod r</span></span><br><span class="line">    u64 m = (u64) q * n;      <span class="comment">// m = q * n</span></span><br><span class="line">    u32 y = (x - m) &gt;&gt; <span class="number">32</span>;    <span class="comment">// y = (x - m) / r</span></span><br><span class="line">    <span class="keyword">return</span> x &lt; m ? y + n : y; <span class="comment">// if y &lt; 0, add n to make it be in the [0, n) range</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This last check is relatively cheap, but it is still on the critical path. If we are fine with the result being in the \([0,2\cdot n−2]\) range instead of \([0, n)\), we can remove it and add \(n\) to the result unconditionally:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">u32 <span class="title">reduce</span><span class="params">(u64 x)</span> </span>&#123;</span><br><span class="line">    u32 q = <span class="built_in">u32</span>(x) * nr;</span><br><span class="line">    u64 m = (u64) q * n;</span><br><span class="line">    u32 y = (x - m) &gt;&gt; <span class="number">32</span>;</span><br><span class="line">    <span class="keyword">return</span> y + n</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can also move the <code>&gt;&gt; 32</code> operation one step earlier in the computation graph and compute \(\lfloor x&#x2F;r \rfloor - \lfloor m&#x2F;r \rfloor\) instead of \( (x-m)&#x2F;r\). This is correct because the lower 32 bits of \(x\) and \(m\) are equal anyway since<br>\[ m &#x3D; x\cdot n’ \cdot n &#x3D; x \mod r\] (mod r is same as taking the lower 32 bits).</p>
<p>But why would we voluntarily choose to perfom two right-shifts instead of just one? This is beneficial because for <code>((u64) q * n) &gt;&gt; 32</code> we need to do a 32-by-32 multiplication and take the upper 32 bits of the result (which the x86 mul instruction already writes in a separate register, so it doesn’t cost anything), and the other right-shift <code>x &gt;&gt; 32</code> is not on the critical path.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">u32 <span class="title">reduce</span><span class="params">(u64 x)</span> </span>&#123;</span><br><span class="line">    u32 q = <span class="built_in">u32</span>(x) * nr;</span><br><span class="line">    u32 m = ((u64) q * n) &gt;&gt; <span class="number">32</span>;</span><br><span class="line">    <span class="keyword">return</span> (x &gt;&gt; <span class="number">32</span>) + n - m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>if to reduce a u128 number（u64 * u64). it is as below</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">__uint128_t</span> u128;</span><br><span class="line"></span><br><span class="line"><span class="function">u64 <span class="title">reduce</span><span class="params">(u128 x)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    u64 q = <span class="built_in">u64</span>(x) * nr;</span><br><span class="line">    u64 m = ((u128) q * n) &gt;&gt; <span class="number">64</span>;</span><br><span class="line">    <span class="keyword">return</span> (x &gt;&gt; <span class="number">64</span>) + n - m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Faster-Inverse"><a href="#Faster-Inverse" class="headerlink" title="Faster Inverse"></a>Faster Inverse</h1><p>Montgomery multiplication itself is fast, but it requires some precomputation:</p>
<ul>
<li>inverting \(n\) modulo \(r\) to compute \(n’\)</li>
<li>transforming a number to the Montgomery space,</li>
<li>transforming a number from the Montgomery space.</li>
</ul>
<p>The last operation is already efficiently performed with the reduce procedure we just implemented, but the first <code>inverting</code> can be slightly optimized.<br>Computing the inverse \(n’ &#x3D; n^{-1} \mod r\) can be done faster than with the extended Euclidean algorith by taking advantage of the fact that \(r\) is a power of two and using the following identity:<br>\[ a\cdot x &#x3D; 1 \mod 2^k &#x3D;&gt; a\cdot x\cdot (2-a\cdot x) &#x3D; 1 \mod 2^{2k} \]<br>Proof:<br> \[<br>  \displaylines{<br> a\cdot x \cdot (2-a\cdot x) &#x3D; 2\cdot a\cdot x - (a\cdot x)^2 \\<br> &#x3D; 2\cdot(1+m\cdot 2^k) - (1+m\cdot 2^k)^2 \\<br> &#x3D; 2 + 2\cdot m\cdot 2^k - 1-2\cdot m \cdot 2^k -m^2\cdot 2^{2k} \\<br> &#x3D; 1-m^2\cdot 2^{2k} \\<br> &#x3D; 1 \mod 2^{2k}<br>}<br>  \]<br><strong>note</strong></p>
<ul>
<li>\(a\cdot x \) coudl be represented by \(1+m\cdot 2^k\) as \(a\cdot x &#x3D; 1 \mod 2^k\)</li>
</ul>
<p>as for our case, \(x\) is \(nr\), \(a\) is \(n\). i.e \(n\cdot nr &#x3D; 1 \mod 2^k\). Since \(n \) is an odd number, we can start with \(nr&#x3D;1\) as the inverse of \(n\) modulo \(2^1\). then applying this identity one time, i.e \(n\cdot 1 \cdot (2-n\cdot 1) &#x3D; 1 \mod 2^2\). Let \(nr &#x3D; 1\cdot(2-n\cdot 1) \), we apply this identity again, and get \(n\cdot nr \cdot (2-a\cdot nr) &#x3D; 1 \mod 2^4\). Following this approach, and apply this identity exactly \(log_2^m\) times, where \(m\) is the bit length of \(r\)</p>
<h2 id="Complement-Implementation"><a href="#Complement-Implementation" class="headerlink" title="Complement Implementation"></a>Complement Implementation</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><ul>
<li><a target="_blank" rel="noopener" href="https://en.algorithmica.org/hpc/number-theory/montgomery/">https://en.algorithmica.org/hpc/number-theory/montgomery/</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/mutourend/article/details/95613967">csdn blog on montgomery reduction</a></li>
<li><a target="_blank" rel="noopener" href="https://www.nayuki.io/page/montgomery-reduction-algorithm">nayuki montgomery reduction</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/12/07/arithmatic/montgomery-multiplication/" data-id="clphpvdof0000aj7u9gaz5qfy" data-title="montgomery multiplication" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/number-theory/" rel="tag">number_theory</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-cryptography/zkp/kzg-commitment" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/12/03/cryptography/zkp/kzg-commitment/" class="article-date">
  <time class="dt-published" datetime="2023-12-03T03:19:44.000Z" itemprop="datePublished">2023-12-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/12/03/cryptography/zkp/kzg-commitment/">kzg polynomial commitment</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript">
</script>

<h2 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h2><p>KZG polynomial commitments was introduced by Kate, Zaverucha and Goldberg. It is called a commitment, because having sent the commitment value (an elliptic curve point) to someone (the verifier), the prover cannot change the polynomial they are working with.</p>
<h2 id="Comparison-to-Merkle-trees"><a href="#Comparison-to-Merkle-trees" class="headerlink" title="Comparison to Merkle trees"></a>Comparison to Merkle trees</h2><p>A Merkle tree is what cryptographers call a vector commitment: Using a Merkle tree of depth \(d\), you can compute a commitment to a vector. A polynomial commitment can be achived by making a merkle tree commitment of all polynomials coefficients. however, it is not efficient.</p>
<h2 id="parings"><a href="#parings" class="headerlink" title="parings"></a>parings</h2><p>Let \(\mathbb{G_1}\) and \(\mathbb{G_2}\) be two elliptic curves wit a paring \(e: \mathbb{G_1} \times \mathbb{G_2} \rightarrow \mathbb{G_T}\). Let \(p\) be the order of \(\mathbb{G_1}\) and \(\mathbb{G_2}\), and \(G\) and \(H\) be generators of \(\mathbb{G_1}\) and \(\mathbb{G_2}\). We will use a very useful shorhand notation<br>\( [x]_1 &#x3D; xG \in \mathbb{G_1}\), and \([x]_2 &#x3D; xH \in \mathbb{G_2} \), for any \(x \in \mathbb{F_p}\)</p>
<h2 id="Trusted-setup"><a href="#Trusted-setup" class="headerlink" title="Trusted setup"></a>Trusted setup</h2><p>Let’s assume we have a trusted setup, so that for some secret \(s\), the elements \([s^i]_1\) and \([s^i]_2\) are available to both prover and verifier for \(i&#x3D;0, …, n-1\). </p>
<p>Let \(p(X) &#x3D; \sum_{i&#x3D;0}^{n}p_i X^i \) be a polynomial, the prover can compute</p>
<p>\( \left[ p(s) \right]_1 &#x3D; p_0[s^0]_1 + p_1[s^1]_1 + … + p_n[s^n]_1 \)</p>
<h2 id="Kate-commitment"><a href="#Kate-commitment" class="headerlink" title="Kate commitment"></a>Kate commitment</h2><p>In the Kate commitment scheme, the eleemnt \(C &#x3D; [p(s)]_1\) is the commitment to the polynomial \(p(X)\).  Could the prover (without knowing \(s\)) find another polynomial \(q(X) \neq p(X)\)  that has the same commitment. Let’s assume that this were the case. Then it would mean \([p(s) - q(s)]_1 &#x3D; 0\), implying \(p(s) - q(s) &#x3D; 0\).</p>
<p>Now, \(r(X) &#x3D; p(X) - q(X)\) is itself a polynomial. we know that it’s not constant because \(p(X) \neq q(X) \).  It is a well-known fact that any non-constant polynomial of degree \(n\) can have at most \(n\) zeroes.<br>Since the prover doesn’t know \(s\), the only way they could achieve that \(p(s) - q(s) &#x3D; 0\)<br> is by making \( p(X) - q(X)&#x3D;0\) in as many places as possible. But since they can do that in at most \(n\)<br> places, as we’ve just proved, they are very unlikely to succeed: since \(n\) is much smaller than the order of the curve, \(p\). the probability that  \(s\) will be one of the points they chose to make \(p(X) &#x3D; q(X)\) will be vanishingly tiny.</p>
<h2 id="Multiplying-polynomials"><a href="#Multiplying-polynomials" class="headerlink" title="Multiplying polynomials"></a>Multiplying polynomials</h2><p>While elliptic curves themselves don’t allow polynomial multiplication, luckily we can do it with pairings: We have that<br>\[ e([a]_1, [b]_2) &#x3D; e(G,H)^{(ab)} &#x3D; [ab]_T\]<br>while we unfortunately can’t just multiply two field elements inside an elliptic curve and get their product as an elliptic curve element, we can multiply two field elements if we commited to them in different curves (one in \(G_1\) and one in \(G_2\), and the output is a<br>\(G_T\) element.</p>
<p>Noe let’s say we want to prove that \(p(z)&#x3D;y\). we will use the polynomial \(p(X) - y\). this polynomial is clearly zero at \(z\). Let \(q(X)\) be the polynomial \(p(X) - y\) divided by the linear factor \(X-z\), i.e<br>\[ q(X) &#x3D; \frac{p(X) - y}{X-z} \]<br>which is equivalent to saying that \(q(X)(X-z) &#x3D; p(X) - y\)</p>
<h2 id="Kate-proofs"><a href="#Kate-proofs" class="headerlink" title="Kate proofs"></a>Kate proofs</h2><p>now a kate proof for the evaluation \(p(z) &#x3D; y\) is defined as \(\pi &#x3D; [q(s)]_1\). remember the commitment to the polynomial \(p(X)\) is defined as \(C&#x3D;[p(s)]_1\)<br>the verifier checks this proof using the following equation<br>\( e(\pi, [s-z]_2) &#x3D; e(C-[y]_1, H) \)</p>
<p>Note that the verifier can compute \([s-z]_2\), because it is just a combination of the element \([s]_2\)<br> from the trusted setup and \(z\) is the point at which the polynomial is evaluated. </p>
<h2 id="multiproofs"><a href="#multiproofs" class="headerlink" title="multiproofs"></a>multiproofs</h2><p>So far we have shown how to prove an evaluation of a polynomial at a single point. Note that this is already pretty amazing: You can show that some polynomial that could be any degree – say \(2^{28}\) – at some point takes a certain value, by only sending a single group element (that could be 48 bytes, for example in BLS12_381). The toy example of using Merkle trees as polynomial commitments would have needed to send \(2^{28}\) elements – all the coefficients of the polynomial.</p>
<p>Let’s say we have a list of \(k\) points \((z_0, y_0),(z_1, y_1), …, (z_{k-1}, y_{k-1})\). Using lagrange interpolation, we can find polynomial \(I(X)\) goes through all of these points.</p>
<p>Now let’s assume that we know \(p(X)\) goes through all these points. then the polynomial \(p(X) - I(X)\) will clearly be zero at each \(z_0, z_1, …, z_{k-1}\). the zero polynomial is<br>\(Z(X) &#x3D; (X-z_0)\cdot (X-z_1)…(X-z_{k-1})\)<br>Now, we can compute the quotient<br>\(q(X) &#x3D; \frac{p(X)-I(X)}{Z(X)}\)<br>We can now define the Kate multiproof for the evaluations \((z_0, y_0),(z_1, y_1),…, (z_{k-1}, y_{k-1})\): \(\pi &#x3D; [q(s)]_1\). note that this is still only one group element.</p>
<p>Now, to check this, the verifier will also have to compute the interpolation polynomial \(I(X)\) and the zero polynomial Z(X). Using this, they can compute \([Z(s)]_2\) and \([I(s)]_1\), and thus verify the paring equation<br>\[ e(\pi, [Z(s)]_2) &#x3D; e(C-[I(s)]_1, H) \]</p>
<h2 id="Kate-as-a-vector-commitment"><a href="#Kate-as-a-vector-commitment" class="headerlink" title="Kate as a vector commitment"></a>Kate as a vector commitment</h2><p>While the Kate commitment scheme is designed as a polynomial commitment, it actually also makes a really nice vector commitment. Remember that a vector commitment commits to a vector \(a_0, …, a_{n-1}\) and lets you prove that you committed to \(a_i\) for some \(i\). We can reproduce this using the Kate commitment scheme: Let \(p(X)\) be the polynomial that for all \(i\) evaluates as \(p(i)&#x3D;a_i\).<br>Now using this polynomial, we can prove any number of elements in the vector using just a single group element! Note how much more efficient (in terms of proof size) this is compared to Merkle trees</p>
<h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><p><a target="_blank" rel="noopener" href="https://dankradfeist.de/ethereum/2020/06/16/kate-polynomial-commitments.html">Dankrad Feist Post</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/12/03/cryptography/zkp/kzg-commitment/" data-id="clpoya0gr0000pksj12ah1gzj" data-title="kzg polynomial commitment" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cryptography/" rel="tag">cryptography</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zkp/" rel="tag">zkp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-cryptography/zkp/circom" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/12/03/cryptography/zkp/circom/" class="article-date">
  <time class="dt-published" datetime="2023-12-03T03:19:44.000Z" itemprop="datePublished">2023-12-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/12/03/cryptography/zkp/circom/">circom</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript">
</script>

<h2 id="Arithmetic-Operators"><a href="#Arithmetic-Operators" class="headerlink" title="Arithmetic Operators"></a>Arithmetic Operators</h2><p>| operator |example|explanation|<br>|—|:—:|:—:|—:|<br>||a \b| Quotient of the integer division |<br>|%|a % b| Remainder of the integer division |</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/12/03/cryptography/zkp/circom/" data-id="clqcbi48m00002y7uaaykdllj" data-title="circom" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/circom/" rel="tag">circom</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cryptography/" rel="tag">cryptography</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zkp/" rel="tag">zkp</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/arithmatic/" rel="tag">arithmatic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blockchain/" rel="tag">blockchain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cargo/" rel="tag">cargo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/circom/" rel="tag">circom</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cpp/" rel="tag">cpp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cryptography/" rel="tag">cryptography</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cuda/" rel="tag">cuda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ec/" rel="tag">ec</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ecdsa/" rel="tag">ecdsa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/field/" rel="tag">field</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/geth/" rel="tag">geth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/" rel="tag">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/" rel="tag">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mpc/" rel="tag">mpc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/number-theory/" rel="tag">number_theory</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rust/" rel="tag">rust</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rust-crate/" rel="tag">rust-crate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rust-std/" rel="tag">rust-std</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/" rel="tag">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zkp/" rel="tag">zkp</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/arithmatic/" style="font-size: 12.22px;">arithmatic</a> <a href="/tags/blockchain/" style="font-size: 15.56px;">blockchain</a> <a href="/tags/cargo/" style="font-size: 10px;">cargo</a> <a href="/tags/circom/" style="font-size: 10px;">circom</a> <a href="/tags/cpp/" style="font-size: 14.44px;">cpp</a> <a href="/tags/cryptography/" style="font-size: 20px;">cryptography</a> <a href="/tags/cuda/" style="font-size: 12.22px;">cuda</a> <a href="/tags/ec/" style="font-size: 11.11px;">ec</a> <a href="/tags/ecdsa/" style="font-size: 10px;">ecdsa</a> <a href="/tags/field/" style="font-size: 10px;">field</a> <a href="/tags/geth/" style="font-size: 16.67px;">geth</a> <a href="/tags/golang/" style="font-size: 11.11px;">golang</a> <a href="/tags/math/" style="font-size: 12.22px;">math</a> <a href="/tags/mpc/" style="font-size: 10px;">mpc</a> <a href="/tags/number-theory/" style="font-size: 10px;">number_theory</a> <a href="/tags/rust/" style="font-size: 18.89px;">rust</a> <a href="/tags/rust-crate/" style="font-size: 10px;">rust-crate</a> <a href="/tags/rust-std/" style="font-size: 13.33px;">rust-std</a> <a href="/tags/tool/" style="font-size: 10px;">tool</a> <a href="/tags/zkp/" style="font-size: 17.78px;">zkp</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/06/13/math/polynomials/">polynomials</a>
          </li>
        
          <li>
            <a href="/2024/01/16/arithmatic/multiplications/">(no title)</a>
          </li>
        
          <li>
            <a href="/2024/01/08/math/multi-scalar-multiplication/">multi scalar multiplication (MSM)</a>
          </li>
        
          <li>
            <a href="/2024/01/01/rust/rust_analyzer/">rust analyzer</a>
          </li>
        
          <li>
            <a href="/2023/12/20/cpp/build/">cpp build</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 cliff<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>