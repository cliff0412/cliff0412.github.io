<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>cliff&#39;s personal blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="cliff&#39;s personal blog">
<meta property="og:url" content="https://cliff0412.github.io/page/2/index.html">
<meta property="og:site_name" content="cliff&#39;s personal blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="cliff">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="cliff's personal blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">cliff&#39;s personal blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://cliff0412.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-cpp/key_words" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/21/cpp/key_words/" class="article-date">
  <time class="dt-published" datetime="2023-11-21T03:35:20.000Z" itemprop="datePublished">2023-11-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/21/cpp/key_words/">cpp key workds</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><p><code>decltype</code><br><code>decltype</code> is a keyword that is used to obtain the type of an expression or an entity</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">42</span>;</span><br><span class="line">    <span class="type">double</span> y = <span class="number">3.14</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Using decltype to declare a variable with the same type as another variable</span></span><br><span class="line">    <span class="keyword">decltype</span>(x) result1 = x;  <span class="comment">// result1 has the type int</span></span><br><span class="line">    <span class="keyword">decltype</span>(y) result2 = y;  <span class="comment">// result2 has the type double</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Using decltype with an expression</span></span><br><span class="line">    <span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span> b = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">decltype</span>(a + b) sum = a + b;  <span class="comment">// sum has the type int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>friend</code><br>In C++, the friend keyword is used to grant non-member functions or other classes access to the private and protected members of a class. When a function or class is declared as a friend of another class, it is allowed to access private and protected members of that class as if it were a member of that class.</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/11/21/cpp/key_words/" data-id="clp8cm0w50003l57ubl7e5d6y" data-title="cpp key workds" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cpp/" rel="tag">cpp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-cpp/std" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/21/cpp/std/" class="article-date">
  <time class="dt-published" datetime="2023-11-21T03:35:20.000Z" itemprop="datePublished">2023-11-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/21/cpp/std/">cpp std</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="snprintf"><a href="#snprintf" class="headerlink" title="snprintf"></a>snprintf</h1><p><code>snprintf</code> is a function that formats a string and writes the resulting characters to a character array.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">snprintf</span><span class="params">(<span class="type">char</span> *str, <span class="type">size_t</span> size, <span class="type">const</span> <span class="type">char</span> *format, ...)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>str</code>: A pointer to the destination buffer where the resulting string is stored.</li>
<li><code>size</code>: The size of the destination buffer (including the null-terminating character).</li>
<li><code>format</code>: A format string that specifies the desired format of the output.</li>
<li><code>...</code>: Additional arguments corresponding to the placeholders in the format string.<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">size_t</span> n = std::<span class="built_in">snprintf</span>(<span class="literal">nullptr</span>, <span class="number">0</span>, <span class="string">&quot;%s&quot;</span>, <span class="string">&quot;hello, world&quot;</span>);</span><br><span class="line">    std::cout &lt;&lt; n &lt;&lt; std::endl;  <span class="comment">// print 12</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="string"><a href="#string" class="headerlink" title="string"></a>string</h1><h2 id="std-string-n-39-0-39"><a href="#std-string-n-39-0-39" class="headerlink" title="std::string(n, &#39;\0&#39;)"></a><code>std::string(n, &#39;\0&#39;)</code></h2><p>creates a string with a length of <code>n</code> and fills it with null characters (‘\0’).</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> n = <span class="number">10</span>;</span><br><span class="line"><span class="function">std::string <span class="title">myString</span><span class="params">(n, <span class="string">&#x27;\0&#x27;</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="strerror-r"><a href="#strerror-r" class="headerlink" title="strerror_r"></a><code>strerror_r</code></h2><p>is a function that is commonly used for thread-safe retrieval of error messages. The purpose of this function is to convert an error number (an integer typically set by a system call or library function to indicate an error) into a human-readable error message</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">strerror_r</span><span class="params">(<span class="type">int</span> errnum, <span class="type">char</span> *buf, <span class="type">size_t</span> buflen)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>errnum</code>: The error number for which you want to retrieve the error message.</li>
<li><code>buf</code>: A pointer to the buffer where the error message will be stored.</li>
<li><code>buflen</code>: The size of the buffer pointed to by buf.</li>
</ul>
<h2 id="others"><a href="#others" class="headerlink" title="others"></a>others</h2><ul>
<li><code>strncpy</code>: Copy no more than N characters of SRC to DEST.</li>
<li><code>std::strlen</code>: Return the length of String.</li>
<li><code>std::strstr</code> is a standard C library function that is used to find the first occurrence of a substring within a string. The function returns a pointer to the first occurrence of the substring in the given string, or NULL if the substring is not found.</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/11/21/cpp/std/" data-id="clp8cm0w60004l57uckd04dmz" data-title="cpp std" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cpp/" rel="tag">cpp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-arithmatic/goldilocks-field" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/18/arithmatic/goldilocks-field/" class="article-date">
  <time class="dt-published" datetime="2023-11-18T03:06:53.000Z" itemprop="datePublished">2023-11-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/18/arithmatic/goldilocks-field/">goldilocks field</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript">
</script>

<h1 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h1><p>\( p &#x3D; \phi^2 - \phi + 1\)<br>\( \epsilon  &#x3D; \phi -1\)</p>
<h2 id="Goldilocks-Addition"><a href="#Goldilocks-Addition" class="headerlink" title="Goldilocks Addition"></a>Goldilocks Addition</h2><p>let \( a &#x3D; a_0 + a_1 \cdot \phi, b &#x3D; b_0 + b_1 \cdot \phi\)</p>
<p><code>(c, carry) = a + b</code>;</p>
<ul>
<li>if carry &#x3D; 0 &amp;&amp; c &gt; p, result should be <code>c -p</code></li>
<li>if carry &#x3D; 0 &amp;&amp; c &lt; p, result should be <code>c</code></li>
<li>if carry &#x3D; 1<br>let \( c &#x3D; c_0 + c_1 \cdot \phi + c_2 \cdot \phi^2\), and \(c_2 &#x3D; 1 \). let \( u &#x3D; c_0 + c_1 \cdot \phi \)<br>therefore \(a + b \mod p\) should be \( a + b - p &#x3D; c_0 + c_1 \cdot \phi + \phi^2 - (\phi^2 - \phi + 1) &#x3D;c_0 + c_1 \cdot \phi + \phi - 1 &#x3D; u + \phi - 1\) <ul>
<li>if \( u  &lt;  p\), computationally, \( u  -  p\) will borrow from \( \phi^2\), which is equivalent to<br>\( \phi^2 + u - p &#x3D; u + \phi - 1  \), which is \( a - b \mod p\). therefore, the result is just \( u-p \)</li>
<li>if \( u&gt; p\), this will unlikely occur, if u &gt;p, given by \( \phi^2 &gt; p \), so \( u + \phi^2 &gt; p + \phi^2 &gt; 2p\) that means a or b is not in canonical form. <span style="color:red"><strong>does not consider this case for now</strong></span></li>
</ul>
</li>
</ul>
<h2 id="Goldilocks-Subtraction"><a href="#Goldilocks-Subtraction" class="headerlink" title="Goldilocks Subtraction"></a>Goldilocks Subtraction</h2><p>\(a - b \mod MOD\)<br>if a &lt; b, a - b is negative, and the binary representation is 2’s complement of the negative value. therefore, it’s requied to add by MOD and treat the final binary representation as positive value.</p>
<h2 id="Goldilocks-Multiplication"><a href="#Goldilocks-Multiplication" class="headerlink" title="Goldilocks Multiplication"></a>Goldilocks Multiplication</h2><p>let \(a &#x3D; a_0 + a_1 \cdot \phi\), and \(b&#x3D;b_0 + b_1 \cdot \phi\)<br>to compute \(c &#x3D; a \cdot b\)</p>
<ul>
<li>first, turn it into \( a_0 \cdot b_0 +(a_1\cdot b_0 +a_0\cdot b_1)\cdot \phi + a_1 \cdot b_1 \phi^2 \)<br>it may carry to \( \phi^2 \). so the results is a <code>u128</code> (<code>[u32;4]</code>)</li>
<li>second, reduce the <code>[u32;4]</code> to <code>u64</code>, details to be described in the following section.</li>
</ul>
<h2 id="plonky2-Goldilocks-Fieldreduce128"><a href="#plonky2-Goldilocks-Fieldreduce128" class="headerlink" title="plonky2 Goldilocks Fieldreduce128"></a>plonky2 Goldilocks Fieldreduce128</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">reduce128</span>(x: <span class="type">u128</span>) <span class="punctuation">-&gt;</span> GoldilocksField &#123;</span><br><span class="line">    <span class="keyword">let</span> (x_lo, x_hi) = <span class="title function_ invoke__">split</span>(x); <span class="comment">// This is a no-op</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x_hi_hi</span> = x_hi &gt;&gt; <span class="number">32</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x_hi_lo</span> = x_hi &amp; EPSILON;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (<span class="keyword">mut</span> t0, borrow) = x_lo.<span class="title function_ invoke__">overflowing_sub</span>(x_hi_hi);</span><br><span class="line">    <span class="keyword">if</span> borrow &#123;</span><br><span class="line">        <span class="title function_ invoke__">branch_hint</span>(); <span class="comment">// A borrow is exceedingly rare. It is faster to branch.</span></span><br><span class="line">        t0 -= EPSILON; <span class="comment">// Cannot underflow.</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">t1</span> = x_hi_lo * EPSILON;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">t2</span> = <span class="keyword">unsafe</span> &#123; <span class="title function_ invoke__">add_no_canonicalize_trashing_input</span>(t0, t1) &#125;;</span><br><span class="line">    <span class="title function_ invoke__">GoldilocksField</span>(t2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>let \( n &#x3D; n_0 + n_1 \cdot \phi + n_2 \cdot \phi^{2} + n_3 \cdot \phi^{3}\)<br>since, \(\phi^{3} &#x3D; -1\), \(n\) could be reduced to \( n &#x3D; n_0 + n_1 \cdot \phi + n_2 \cdot \phi^{2} - n_3  \),<br>which is line 6 in the above code snipet. when borrow occurs, it means it borrows \( \phi^2\) ( subtraction is of u64, so borrow 1 menas add \( \phi^2\), <code>1&lt;&lt;64</code>). therefore, needs to reduce \( \phi^2\). since \( \phi^2 &#x3D; \phi - 1\), which is reduce by \( \phi - 1\) (this is <code>EPSILON</code>).<br><strong>Note</strong> needs to consider line 23 could underflow</p>
<p>next step is to reduce \( n_2 \cdot \phi^2 \), which is just \( n_2 \cdot (\phi -1)  \), which is \( n_2 \cdot EPSILON  \), line 11, <code>x_hi_lo * EPSILON</code></p>
<h2 id="Sppark-reduce-uint32-t-temp-4"><a href="#Sppark-reduce-uint32-t-temp-4" class="headerlink" title="Sppark reduce(uint32_t temp[4])"></a>Sppark reduce(uint32_t temp[4])</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">reduce</span><span class="params">(<span class="type">uint32_t</span> temp[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> carry;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">asm</span>(<span class="string">&quot;sub.cc.u32 %0, %0, %3; subc.cc.u32 %1, %1, %4; subc.u32 %2, 0, 0;&quot;</span></span><br><span class="line">        : <span class="string">&quot;+r&quot;</span>(temp[<span class="number">0</span>]), <span class="string">&quot;+r&quot;</span>(temp[<span class="number">1</span>]), <span class="string">&quot;=r&quot;</span>(carry)</span><br><span class="line">        : <span class="string">&quot;r&quot;</span>(temp[<span class="number">2</span>]), <span class="string">&quot;r&quot;</span>(temp[<span class="number">3</span>]));</span><br><span class="line">    <span class="built_in">asm</span>(<span class="string">&quot;add.cc.u32 %0, %0, %2; addc.u32 %1, %1, %3;&quot;</span></span><br><span class="line">        : <span class="string">&quot;+r&quot;</span>(temp[<span class="number">1</span>]), <span class="string">&quot;+r&quot;</span>(carry)</span><br><span class="line">        : <span class="string">&quot;r&quot;</span>(temp[<span class="number">2</span>]), <span class="string">&quot;r&quot;</span>(temp[<span class="number">3</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">asm</span>(<span class="string">&quot;mad.lo.cc.u32 %0, %3, %4, %0; madc.hi.cc.u32 %1, %3, %4, %1; addc.u32 %2, 0, 0;&quot;</span></span><br><span class="line">        : <span class="string">&quot;+r&quot;</span>(temp[<span class="number">0</span>]), <span class="string">&quot;+r&quot;</span>(temp[<span class="number">1</span>]), <span class="string">&quot;=r&quot;</span>(temp[<span class="number">2</span>])</span><br><span class="line">        : <span class="string">&quot;r&quot;</span>(carry), <span class="string">&quot;r&quot;</span>(gl64_device::W));</span><br><span class="line">    <span class="built_in">asm</span>(<span class="string">&quot;mad.lo.cc.u32 %0, %2, %3, %0; madc.hi.u32 %1, %2, %3, %1;&quot;</span></span><br><span class="line">        : <span class="string">&quot;+r&quot;</span>(temp[<span class="number">0</span>]), <span class="string">&quot;+r&quot;</span>(temp[<span class="number">1</span>])</span><br><span class="line">        : <span class="string">&quot;r&quot;</span>(temp[<span class="number">2</span>]), <span class="string">&quot;r&quot;</span>(gl64_device::W));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">asm</span>(<span class="string">&quot;mad.lo.cc.u32 %0, %2, %3, %0; madc.hi.u32 %1, %2, %3, %1;&quot;</span></span><br><span class="line">        : <span class="string">&quot;+r&quot;</span>(temp[<span class="number">0</span>]), <span class="string">&quot;+r&quot;</span>(temp[<span class="number">1</span>])</span><br><span class="line">        : <span class="string">&quot;r&quot;</span>(temp[<span class="number">2</span>]), <span class="string">&quot;r&quot;</span>(gl64_device::W));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">asm</span>(<span class="string">&quot;mov.b64 %0, &#123;%1, %2&#125;;&quot;</span> : <span class="string">&quot;=l&quot;</span>(val) : <span class="string">&quot;r&quot;</span>(temp[<span class="number">0</span>]), <span class="string">&quot;r&quot;</span>(temp[<span class="number">1</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>note</strong>: <code>W</code> is epsilon<br>let \( n &#x3D; n_0 + n_1 \cdot \phi + n_2 \cdot \phi^{2} + n_3 \cdot \phi^{3}\)<br>\( n &#x3D; n_0 + n_2\cdot\phi^2 + \phi(n_1+n_3\cdot \phi^2)\).<br>since \( \phi^2 &#x3D; \phi - 1\)<br>\( n &#x3D; n_0 + n_2\cdot(\phi-1) + \phi(n_1+n_3\cdot(\phi-1))\).<br>\( n &#x3D; n_0 -n_2 +n_2\phi + \phi(n_1-n_3 + n_3\cdot\phi)\).<br>\( n &#x3D; n_0 -n_2 + \phi(n_1-n_3 +n_2) + n_3\cdot\phi^2\).<br>line 5 computes <code>n0 - n2</code> and set to temp[0]; &amp; computes <code>n1-n3</code> and sets to temp[1]<br>line 8 computes <code>n1- n3 + n2</code>; add n_3 with carry and put it to carry.</p>
<p>let \(c\) be the carry, at \(\phi^2\), it is actually \( c \cdot \phi^2\). it could be further reduced to  \(c \cdot (\phi - 1) &#x3D; c \cdot W\)<br>line 12 is to reduce the carry part to temp[0], temp[1], and temp[2].<br>if temp[2] still exist. line 15 will reduce it to temp[0], temp[1] similar as above.<br>at this step. only temp[0] and temp[1] will contains value and return as the result</p>
<h2 id="appendix"><a href="#appendix" class="headerlink" title="appendix"></a>appendix</h2><ul>
<li>underflow<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">uint64_t tmp;</span><br><span class="line">uint32_t borrow;</span><br><span class="line">asm(&quot;&#123; .reg.pred %top;&quot;);</span><br><span class="line">asm(&quot;sub.cc.u64 %0, %0, %2; subc.u32 %1, 0, 0;&quot;</span><br><span class="line">    : &quot;+l&quot;(val), &quot;=r&quot;(borrow)</span><br><span class="line">    : &quot;l&quot;(b.val));</span><br></pre></td></tr></table></figure>
all bits of borrow will be set to 1 if underflow occurs</li>
</ul>
<h1 id="references"><a href="#references" class="headerlink" title="references"></a>references</h1><ul>
<li><a target="_blank" rel="noopener" href="https://2π.com/22/goldilocks/">The Goldilocks Prime by Remco Bloemem</a></li>
<li><a target="_blank" rel="noopener" href="https://cronokirby.com/notes/2022/09/the-goldilocks-field/">parameters of goldilocks field</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/mutourend/article/details/126407028">csdn blog</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/yrrid/GoldilocksNTT/tree/main">cuda implementation of GoldilocksNTT by yrrid</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/11/18/arithmatic/goldilocks-field/" data-id="clpi1wlcr0000067ufpzn63zv" data-title="goldilocks field" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/arithmatic/" rel="tag">arithmatic</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-cuda/inline-ptx-assembly-in-cuda" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/15/cuda/inline-ptx-assembly-in-cuda/" class="article-date">
  <time class="dt-published" datetime="2023-11-15T06:47:28.000Z" itemprop="datePublished">2023-11-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/15/cuda/inline-ptx-assembly-in-cuda/">inline ptx assembly in cuda</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h1><p>PTX, a low-level parallel thread execution virtual machine and instruction set architecture (ISA). PTX exposes the GPU as a data-parallel computing device.<br>The PTX Instruction Set Architecture (ISA) is lower-level compared to CUDA C++, but the programming model is entirely the same, with only some terminology differences. For example: CTA (Cooperative Thread Array): Equivalent to the Block in the CUDA thread model.</p>
<h1 id="assembler-statements"><a href="#assembler-statements" class="headerlink" title="assembler statements"></a>assembler statements</h1><h2 id="parameters"><a href="#parameters" class="headerlink" title="parameters"></a>parameters</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">asm</span>(<span class="string">&quot;template-string&quot;</span> : <span class="string">&quot;constraint&quot;</span>(output) : <span class="string">&quot;constraint&quot;</span>(input));</span><br></pre></td></tr></table></figure>
<p>an example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">asm</span>(<span class="string">&quot;add.s32 %0, %1, %2;&quot;</span> : <span class="string">&quot;=r&quot;</span>(i) : <span class="string">&quot;r&quot;</span>(j), <span class="string">&quot;r&quot;</span>(k));</span><br></pre></td></tr></table></figure>
<p>Each <code>%n</code> in the template string is an index into the following list of operands, in text order. So <code>%0</code> refers to the first operand, <code>%1</code> to the second operand, and so on. Since the output operands are always listed ahead of the input operands, they are assigned the smallest indices.<br>Note that the numbered references in the string can be in arbitrary order. The following is equivalent to the above example:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">asm</span>(<span class="string">&quot;add.s32 %0, %2, %1;&quot;</span> : <span class="string">&quot;=r&quot;</span>(i) : <span class="string">&quot;r&quot;</span>(k), <span class="string">&quot;r&quot;</span>(j));</span><br></pre></td></tr></table></figure>
<p>You can also repeat a reference, e.g.:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">asm</span>(<span class="string">&quot;add.s32 %0, %1, %1;&quot;</span> : <span class="string">&quot;=r&quot;</span>(i) : <span class="string">&quot;r&quot;</span>(k));</span><br></pre></td></tr></table></figure>
<p>If there is no input operand, you can drop the final colon, e.g.:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">asm</span>(<span class="string">&quot;mov.s32 %0, 2;&quot;</span> : <span class="string">&quot;=r&quot;</span>(i));</span><br></pre></td></tr></table></figure>

<p>If there is no output operand, the colon separators are adjacent, e.g.:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">asm</span>(<span class="string">&quot;mov.s32 r1, %0;&quot;</span> :: <span class="string">&quot;r&quot;</span>(i));</span><br></pre></td></tr></table></figure>
<p>the “r” constraint refers to a 32bit integer register. The “&#x3D;” modifier in “&#x3D;r” specifies that the register is written to.  There is also available a “+” modifier that specifies the register is both read and written</p>
<p>Multiple instructions can be combined into a single asm() statement;<br>am example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__device__ <span class="type">int</span> <span class="title">cube</span> <span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> y;</span><br><span class="line">  <span class="built_in">asm</span>(<span class="string">&quot;.reg .u32 t1;\n\t&quot;</span>              <span class="comment">// temp reg t1</span></span><br><span class="line">      <span class="string">&quot; mul.lo.u32 t1, %1, %1;\n\t&quot;</span>    <span class="comment">// t1 = x * x</span></span><br><span class="line">      <span class="string">&quot; mul.lo.u32 %0, t1, %1;&quot;</span>        <span class="comment">// y = t1 * x</span></span><br><span class="line">      : <span class="string">&quot;=r&quot;</span>(y) : <span class="string">&quot;r&quot;</span> (x));</span><br><span class="line">  <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="constraints"><a href="#constraints" class="headerlink" title="constraints"></a>constraints</h2><p>There is a separate constraint letter for each PTX register type:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;h&quot;</span> = .u16 reg</span><br><span class="line"><span class="string">&quot;r&quot;</span> = .u32 reg</span><br><span class="line"><span class="string">&quot;l&quot;</span> = .u64 reg</span><br><span class="line"><span class="string">&quot;f&quot;</span> = .f32 reg</span><br><span class="line"><span class="string">&quot;d&quot;</span> = .f64 reg</span><br></pre></td></tr></table></figure>
<p>The constraint “n” may be used for immediate integer operands with a known value. Example:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">asm</span>(<span class="string">&quot;add.u32 %0, %0, %1;&quot;</span> : <span class="string">&quot;=r&quot;</span>(x) : <span class="string">&quot;n&quot;</span>(<span class="number">42</span>));</span><br></pre></td></tr></table></figure>


<h1 id="State-Space-Type-Identifier"><a href="#State-Space-Type-Identifier" class="headerlink" title="State Space + Type + Identifier"></a>State Space + Type + Identifier</h1><h2 id="state-spaces"><a href="#state-spaces" class="headerlink" title="state spaces"></a>state spaces</h2><p>A state space is a storage area with particular characteristics. All variables reside in some state space. </p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>.reg</td>
<td>Registers, fast.</td>
</tr>
<tr>
<td>.sreg</td>
<td>Special registers. Read-only; pre-defined; platform-specific.</td>
</tr>
<tr>
<td>.const</td>
<td>Shared, read-only memory.</td>
</tr>
<tr>
<td>.global</td>
<td>Global memory, shared by all threads.</td>
</tr>
<tr>
<td>.local</td>
<td>Local memory, private to each thread.</td>
</tr>
<tr>
<td>.param</td>
<td>Kernel parameters, defined per-grid; or Function or local parameters, defined per-thread.</td>
</tr>
<tr>
<td>.shared</td>
<td>Addressable memory, defined per CTA, accessible to all threads in the cluster throughout the lifetime of the CTA that defines it.</td>
</tr>
</tbody></table>
<h2 id="types"><a href="#types" class="headerlink" title="types"></a>types</h2><h3 id="fundamental-types"><a href="#fundamental-types" class="headerlink" title="fundamental types"></a>fundamental types</h3><p>In PTX, the fundamental types reflect the native data types supported by the target architectures.</p>
<table>
<thead>
<tr>
<th>Basic Type</th>
<th>Fundamental Type Specifiers</th>
</tr>
</thead>
<tbody><tr>
<td>Signed integer</td>
<td>.s8, .s16, .s32, .s64</td>
</tr>
<tr>
<td>Unsigned integer</td>
<td>.u8, .u16, .u32, .u64</td>
</tr>
<tr>
<td>Floating-point</td>
<td>.f16, .f16x2, .f32, .f64</td>
</tr>
<tr>
<td>Bits (untyped)</td>
<td>.b8, .b16, .b32, .b64, .b128</td>
</tr>
<tr>
<td>Predicate</td>
<td>.pred</td>
</tr>
</tbody></table>
<h2 id="variables"><a href="#variables" class="headerlink" title="variables"></a>variables</h2><p>In PTX, a variable declaration describes both the variable’s type and its state space. In addition to fundamental types, PTX supports types for simple aggregate objects such as vectors and arrays.<br><strong>examples</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.global .v4 .f32 V;   <span class="comment">// a length-4 vector of floats</span></span><br><span class="line">.shared .v2 .u16 uv;  <span class="comment">// a length-2 vector of unsigned ints</span></span><br><span class="line">.global .v4 .b8  v;   <span class="comment">// a length-4 vector of bytes</span></span><br></pre></td></tr></table></figure>

<h1 id="references"><a href="#references" class="headerlink" title="references"></a>references</h1><ul>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/inline-ptx-assembly/index.html">nvidia docs inlline ptx assembly</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ibm.com/docs/en/openxl-c-and-cpp-aix/17.1.0?topic=features-inline-assembly-statements">IBM Open XL C&#x2F;C++ Inline Assembly</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#">parallel thread execution ISA guide</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/11/15/cuda/inline-ptx-assembly-in-cuda/" data-id="clp3h29tl0000p97ug63eajx3" data-title="inline ptx assembly in cuda" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cuda/" rel="tag">cuda</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-cpp/types" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/15/cpp/types/" class="article-date">
  <time class="dt-published" datetime="2023-11-15T03:35:20.000Z" itemprop="datePublished">2023-11-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/15/cpp/types/">cpp types</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Conversion-Operator"><a href="#Conversion-Operator" class="headerlink" title="Conversion Operator"></a>Conversion Operator</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyIntegerWrapper</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// Constructor</span></span><br><span class="line">    <span class="built_in">MyIntegerWrapper</span>(<span class="type">int</span> val) : <span class="built_in">value</span>(val) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Conversion operator to int</span></span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">int</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">MyIntegerWrapper <span class="title">myObj</span><span class="params">(<span class="number">42</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Implicit conversion using the conversion operator</span></span><br><span class="line">    <span class="type">int</span> intValue = myObj;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Implicit Conversion: &quot;</span> &lt;&lt; intValue &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Explicit conversion using static_cast</span></span><br><span class="line">    <span class="type">double</span> doubleValue = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(myObj);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Explicit Conversion: &quot;</span> &lt;&lt; doubleValue &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/11/15/cpp/types/" data-id="clp8cm0w60006l57u0fvme5s2" data-title="cpp types" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cpp/" rel="tag">cpp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-cryptography/zkp/plonky2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/06/cryptography/zkp/plonky2/" class="article-date">
  <time class="dt-published" datetime="2023-11-06T05:24:03.000Z" itemprop="datePublished">2023-11-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/06/cryptography/zkp/plonky2/">plonky2 code analysis</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript">
</script>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/11/06/cryptography/zkp/plonky2/" data-id="clphpvdoi0002aj7uc7oscro3" data-title="plonky2 code analysis" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cryptography/" rel="tag">cryptography</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zkp/" rel="tag">zkp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-cryptography/zkp/stark-101" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/03/cryptography/zkp/stark-101/" class="article-date">
  <time class="dt-published" datetime="2023-11-03T09:07:33.000Z" itemprop="datePublished">2023-11-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/03/cryptography/zkp/stark-101/">stark 101</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript">
</script>

<h2 id="trace-and-low-degree-extension"><a href="#trace-and-low-degree-extension" class="headerlink" title="trace and low degree extension"></a>trace and low degree extension</h2><p>the objective is to develop a STARK prover for the FibonacciSq sequence over a finite field. The FibonacciSq sequence is defined by the recurrence relation<br>\[ a_{n+2} &#x3D; a_{n+1} ^2 + a_n ^2 \]</p>
<p>the statement is: <strong>I know a FieldElement \(X\in \mathbb{F}\) such that the 1023rd element of the FibonacciSq sequence starting with \(1, X\) is \(2338775057\)</strong></p>
<p>The underlying field of this class is \(\mathbb{F}_{3221225473}\) (\(3221225473 &#x3D; 3 \cdot 2^{30} + 1\)), so all operations are done modulo 3221225473.</p>
<h3 id="FibonacciSq-Trace"><a href="#FibonacciSq-Trace" class="headerlink" title="FibonacciSq Trace"></a>FibonacciSq Trace</h3><p> let’s construct a list <code>a</code> of length 1023, whose first two elements will be FieldElement objects representing 1 and 3141592, respectively. The next 1021 elements will be the FibonacciSq sequence induced by these two elements. <code>a</code> is called the <strong>trace</strong> of FibonacciSq, or, when the context is clear, the trace.</p>
<h3 id="Thinking-of-Polynomials"><a href="#Thinking-of-Polynomials" class="headerlink" title="Thinking of Polynomials"></a>Thinking of Polynomials</h3><p>We now want to think of the sequence as the evaluation of some polynomial \(f\) of degree 1022.<br>We will choose the domain to be some subgroup \(G \subseteq \mathbb{F}^\times\) of size 1024, for reasons that will become clear later.</p>
<p>(Recall that \(\mathbb{F}^\times\) denotes the multiplicative group of \(\mathbb{F}\), which we get from \(\mathbb{F}\) by omitting the zero element with the induced multiplication from the field. A subgroup of size 1024 exists because \(\mathbb{F}^\times\) is a cyclic group of size \(3\cdot 2^{30}\), so it contains a subgroup of size \(2^i\) for any \(0 \leq i \leq 30\)).</p>
<h4 id="Find-a-Group-of-Size-1024"><a href="#Find-a-Group-of-Size-1024" class="headerlink" title="Find a Group of Size 1024"></a>Find a Group of Size 1024</h4><p>If we find an element \(g \in \mathbb{F}\) whose (multiplicative) order is 1024, then \(g\) will generate such a group. Create a list called <code>G</code> with all the elements of \(G\), such that \(G[i] :&#x3D; g^i\).</p>
<h3 id="Evaluating-on-a-Larger-Domain"><a href="#Evaluating-on-a-Larger-Domain" class="headerlink" title="Evaluating on a Larger Domain"></a>Evaluating on a Larger Domain</h3><p>then, interpolating <code>G</code> over <code>a</code> we get a polynomial <code>f</code>. The trace, viewed as evaluations of a polynomial \(f\) on \(G\), can now be extended by evaluating \(f\) over a larger domain, thereby creating a Reed-Solomon error correction code.</p>
<h4 id="Cosets"><a href="#Cosets" class="headerlink" title="Cosets"></a>Cosets</h4><p>To that end, we must decide on a larger domain on which \(f\) will be evaluated. We will work with a domain that is 8 times larger than \(G\). <br>A natural choice for such a domain is to take some group \(H\) of size 8192 (which exists because 8192 divides \(|\mathbb{F}^\times|\)), and shift it by the generator of \(\mathbb{F}^\times\), thereby obtaining a <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Coset">coset</a> of \(H\).</p>
<p>Create a list called <code>H</code> of the elements of \(H\), and multiply each of them by the generator of \(\mathbb{F}^\times\) to obtain a list called <code>eval_domain</code>. In other words, <code>eval_domain</code> &#x3D; \(\{w\cdot h^i | 0 \leq i &lt;8192  \}\) for \(h\) the generator of \(H\) and \(w\) the generator of \(\mathbb{F}^\times\).</p>
<h4 id="Evaluate-on-a-Coset"><a href="#Evaluate-on-a-Coset" class="headerlink" title="Evaluate on a Coset"></a>Evaluate on a Coset</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f = interpolate_poly(G[:-<span class="number">1</span>], a)</span><br><span class="line">f_eval = [f(d) <span class="keyword">for</span> d <span class="keyword">in</span> eval_domain]</span><br></pre></td></tr></table></figure>

<h3 id="Commitments"><a href="#Commitments" class="headerlink" title="Commitments"></a>Commitments</h3><p>We will use <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/SHA-2">Sha256</a>-based <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Merkle_tree">Merkle Trees</a> as our commitment scheme.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> merkle <span class="keyword">import</span> MerkleTree</span><br><span class="line">f_merkle = MerkleTree(f_eval)</span><br></pre></td></tr></table></figure>

<h3 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h3><p>Theoretically, a STARK proof system is a protocol for interaction between two parties - a prover and a verifier. In practice, we convert this interactive protocol into a non-interactive proof using the <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Fiat%E2%80%93Shamir_heuristic">Fiat-Shamir Heuristic</a>. In this tutorial you will use the <code>Channel</code> class, which implements this transformation. This channel replaces the verifier in the sense that the prover (which you are writing) will send data, and receive random numbers or random <code>FieldElement</code> instances.</p>
<h2 id="constraints"><a href="#constraints" class="headerlink" title="constraints"></a>constraints</h2><p>In this part, we are going to create a set of constraints over the trace <code>a</code>. </p>
<h3 id="Step-1-FibonacciSq-Constraints"><a href="#Step-1-FibonacciSq-Constraints" class="headerlink" title="Step 1 - FibonacciSq Constraints"></a>Step 1 - FibonacciSq Constraints</h3><p>For <code>a</code> to be a correct trace of a FibonacciSq sequence that proves our claim:</p>
<ol>
<li>The first element has to be 1, namely \(a[0] &#x3D; 1\).</li>
<li>The last element has to be 2338775057, namely \(a[1022] &#x3D; 2338775057\).</li>
<li>The FibonacciSq rule must apply, that is - for every \(i&lt;1021\), \(a[i+2]&#x3D;a[i+1]^2+a[i]^2\).</li>
</ol>
<h3 id="Step-2-Polynomial-Constraints"><a href="#Step-2-Polynomial-Constraints" class="headerlink" title="Step 2 - Polynomial Constraints"></a>Step 2 - Polynomial Constraints</h3><p>Recall that <code>f</code> is a polynomial over the trace domain, that evaluates exactly to <code>a</code> over \(G \setminus {g^{1023}}\) where \(G&#x3D;{g^i : 0\leq i\leq 1023}\) is the “small” group generated by \(g\).<br></p>
<p>We now rewrite the above three constraints in a form of polynomial constraints over <code>f</code>:</p>
<ol>
<li>\(a[0] &#x3D; 1\) is translated to the polynomial \(f(x) - 1\), which evalutes to 0 for \(x &#x3D; g^0\) (note that \(g^0\) is \(1\)). <br></li>
<li>\(a[1022] &#x3D; 2338775057\) is translated to the polynomial \(f(x) - 2338775057\), which evalutes to 0 for \(x &#x3D; g^{1022}\). <br></li>
<li>\(a[i+2]&#x3D;a[i+1]^2+a[i]^2\) for every \(i&lt;1021\) is translated to the polynomial \(f(g^2 \cdot x) - (f(g \cdot x))^2 - (f(x))^2\), which evaluates to 0 for \(x \in G \backslash {g^{1021}, g^{1022}, g^{1023}}\). <br><br></li>
</ol>
<h3 id="Step-3-Rational-Functions-That-are-in-Fact-Polynomials"><a href="#Step-3-Rational-Functions-That-are-in-Fact-Polynomials" class="headerlink" title="Step 3 - Rational Functions (That are in Fact Polynomials)"></a>Step 3 - Rational Functions (That are in Fact Polynomials)</h3><p>Each of the constraints above is represented by a polynomial \(u(x)\) that supposedly evaluates to \(0\) on certain elements of the group \(G\). That is, for some \(x_0, \ldots, x_k \in G\), we claim that</p>
<p>\[u(x_0) &#x3D; \ldots &#x3D; u(x_k) &#x3D; 0\]</p>
<p>(note that for the first two constaints, \(k&#x3D;0\) because they only refer to one point and for the third \(k&#x3D;1021\)).</p>
<p>This is equivalent to saying that \(u(x)\) is divisible, as a polynomial, by all of \({(x-x_i)}_{i&#x3D;0}^k\), or, equivalently, by</p>
<p>\[\prod_{i&#x3D;0}^k (x-x_i)\]</p>
<p>Therefore, each of the three constraints above can be written as a rational function of the form:</p>
<p>\[\frac{u(x)}{\prod_{i&#x3D;0}^k (x-x_i)}\]</p>
<p>for the corresponding \(u(x)\) and \({x_i}_{i&#x3D;0}^k\). In this step we will construct these three rational functions and show that they are indeed polynomials.</p>
<h3 id="The-First-Constraint"><a href="#The-First-Constraint" class="headerlink" title="The First Constraint:"></a>The First Constraint:</h3><p>In the first constraint, \(f(x) - 1\) and \({x_i} &#x3D; {1}\).</p>
<p>We will now construct the <strong>polynomial</strong> \(p_0(x)&#x3D;\frac{f(x) - 1}{x - 1}\), making sure that \(f(x) - 1\) is indeed divisible by \((x-1)\).</p>
<h3 id="The-Second-Constraint"><a href="#The-Second-Constraint" class="headerlink" title="The Second Constraint"></a>The Second Constraint</h3><p>Construct the polynomial <code>p1</code> representing the  second constraint, \(p_1(x)&#x3D; \frac{f(x) - 2338775057}{x - g^{1022}}\), similarly: <br></p>
<h3 id="The-Third-Constraint-Succinctness"><a href="#The-Third-Constraint-Succinctness" class="headerlink" title="The Third Constraint - Succinctness"></a>The Third Constraint - Succinctness</h3><p>The last constraint’s rational function is slightly more complicated: <br></p>
<p>\[p_2(x) &#x3D; \frac{f(g^2 \cdot x) - (f(g \cdot x))^2 - (f(x))^2}{\prod\limits_{i&#x3D;0}^{1020} (x-g^i)}\]</p>
<p>whose denominator can be rewritten, so that the entire expression is easier to compute:<br></p>
<p>$$\frac{f(g^2 \cdot x) - (f(g \cdot x))^2 - (f(x))^2}{\frac{x^{1024} - 1}{(x-g^{1021})(x-g^{1022})(x-g^{1023})}}$$ <br></p>
<p>This follows from the equality</p>
<p>$$\prod\limits_{i&#x3D;0}^{1023} (x-g^i) &#x3D; x^{1024} - 1$$</p>
<h3 id="Step-4-Composition-Polynomial"><a href="#Step-4-Composition-Polynomial" class="headerlink" title="Step 4 - Composition Polynomial"></a>Step 4 - Composition Polynomial</h3><p>Recall that we’re translating a problem of checking the validity of three polynomial constraints to checking that each of the rational functions \(p_0, p_1, p_2\) are polynomials. <br></p>
<p>Our protocol uses an algorithm called <a target="_blank" rel="noopener" href="https://eccc.weizmann.ac.il/report/2017/134/">FRI</a> to do so, which will be discussed in the next part. <br><br>In order for the proof to be succinct (short), we prefer to work with just one rational function instead of three. For that, we take a random linear combination of \(p_0, p_1, p_2\) called the <strong>compostion polynomial</strong> (CP for short):</p>
<p>$$CP(x) &#x3D; \alpha_0 \cdot p_0(x) + \alpha_1 \cdot p_1(x) + \alpha_2 \cdot  p_2(x)$$ <br></p>
<p>where \(\alpha_0, \alpha_1, \alpha_2 \) are random field elements obtained from the verifier, or in our case - from the channel.</p>
<p>Proving that (the rational function) \(CP\) is a polynomial guarantess, with high probability, that each of \(p_0, p_1, p_2\) are themselves polynomials.</p>
<h3 id="Commit-on-the-Composition-Polynomial"><a href="#Commit-on-the-Composition-Polynomial" class="headerlink" title="Commit on the Composition Polynomial"></a>Commit on the Composition Polynomial</h3><p>Lastly, we evaluate $cp$ over the evaluation domain (<code>eval_domain</code>), build a Merkle tree on top of that and send its root over the channel. This is similar to commiting on the LDE trace, as we did at the end of part 1.</p>
<p><img src="/images/zkp/stark/trace_to_CP.png" alt="trace to cp"></p>
<h2 id="FRI-Commitments"><a href="#FRI-Commitments" class="headerlink" title="FRI Commitments"></a>FRI Commitments</h2><h3 id="FRI-Folding"><a href="#FRI-Folding" class="headerlink" title="FRI Folding"></a>FRI Folding</h3><p>Our goal in this part is to construct the FRI layers and commit on them.<br><br>To obtain each layer we need:</p>
<ol>
<li>To generate a domain for the layer (from the previous layer’s domain).</li>
<li>To generate a polynomial for the layer (from the previous layer’s polynomial and domain).</li>
<li>To evaluate said polynomial on said domain - <strong>this is the next FRI layer</strong>.</li>
</ol>
<h4 id="Domain-Generation"><a href="#Domain-Generation" class="headerlink" title="Domain Generation"></a>Domain Generation</h4><p>The first FRI domain is simply the <code>eval_domain</code> that you already generated in Part 1, namely a coset of a group of order 8192. Each subsequent FRI domain is obtained by taking the first half of the previous FRI domain (dropping the second half), and squaring each of its elements.<br></p>
<p>Formally - we got <code>eval_domain</code> by taking:<br><br>$$w, w\cdot h, w\cdot h^2, …, w\cdot h^{8191}$$</p>
<p>The next layer will therefore be:<br><br>$$w^2, (w\cdot h)^2, (w\cdot h^2)^2, …, (w\cdot h^{4095})^2$$</p>
<p>Note that taking the squares of the second half of each elements in <code>eval_domain</code> yields exactly<br>the same result as taking the squares of the first half. This is true for the next layers as well.</p>
<p>Similarly, the domain of the third layer will be:<br><br>$$w^4, (w\cdot h)^4, (w\cdot h^2)^4, …, (w\cdot h^{2047})^4$$</p>
<p>And so on.</p>
<h4 id="FRI-Folding-Operator"><a href="#FRI-Folding-Operator" class="headerlink" title="FRI Folding Operator"></a>FRI Folding Operator</h4><p>The first FRI polynomial is simply the composition polynomial, i.e., <code>cp</code>.<br><br>Each subsequent FRI polynomial is obtained by:</p>
<ol>
<li>Getting a random field element \(\beta\) (by calling <code>Channel.receive_random_field_element</code>).</li>
<li>Multiplying the odd coefficients of the previous polynomial by \(\beta\).</li>
<li>Summing together consecutive pairs (even-odd) of coefficients.</li>
</ol>
<p>Formally, let’s say that the k-th polynomial is of degree \(&lt; m\) (for some \(m\) which is a power of 2):</p>
<p>$$p_{k}(x) :&#x3D; \sum _{i&#x3D;0} ^{m-1} c_i x^i$$</p>
<p>Then the (k+1)-th polynomial, whose degree is \(&lt; \frac m 2 \) will be:</p>
<p>\[ p_{k+1}(x) :&#x3D; \sum_{i&#x3D;0} ^{  m &#x2F; 2 - 1 } (c_{2i} + \beta \cdot c_{2i + 1}) x^i \] <br></p>
<p><img src="/images/zkp/stark/fri.png" alt="fri"></p>
<p><img src="/images/zkp/stark/fri_example.png" alt="fri example"></p>
<h3 id="Generating-FRI-Commitments"><a href="#Generating-FRI-Commitments" class="headerlink" title="Generating FRI Commitments"></a>Generating FRI Commitments</h3><p>We have now developed the tools to write the <code>FriCommit</code> method, that contains the main FRI commitment loop.<br></p>
<p>It takes the following 5 arguments:</p>
<ol>
<li>The composition polynomial, that is also the first FRI polynomial, that is - <code>cp</code>.</li>
<li>The coset of order 8192 that is also the first FRI domain, that is - <code>eval_domain</code>.</li>
<li>The evaluation of the former over the latter, which is also the first FRI layer , that is - <code>cp_eval</code>.</li>
<li>The first Merkle tree (we will have one for each FRI layer) constructed from these evaluations, that is - <code>cp_merkle</code>.</li>
<li>A channel object, that is <code>channel</code>.</li>
</ol>
<p>The method accordingly returns 4 lists:</p>
<ol>
<li>The FRI polynomials.</li>
<li>The FRI domains.</li>
<li>The FRI layers.</li>
<li>The FRI Merkle trees.</li>
</ol>
<p>The method contains a loop, in each iteration of which we extend these four lists, using the last element in each.<br>The iteration should stop once the last FRI polynomial is of degree 0, that is - when the last FRI polynomial is just a constant. It should then send over the channel this constant (i.e. - the polynomial’s free term).<br>The <code>Channel</code> class only supports sending strings, so make sure you convert anything you wish to send over the channel to a string before sending.</p>
<p><img src="/images/zkp/stark/commitment.png" alt="commitment"></p>
<h2 id="Query-Phase"><a href="#Query-Phase" class="headerlink" title="Query Phase"></a>Query Phase</h2><p>Get q random elements, provide a valdiation data for each</p>
<p><img src="/images/zkp/stark/decommitment.png" alt="decommitment"></p>
<h1 id="references"><a href="#references" class="headerlink" title="references"></a>references</h1><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/starkware-industries/stark101">https://github.com/starkware-industries/stark101</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/starkware/tagged/stark-math">startk_math</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/starkware/starkdex-deep-dive-introduction-7b4ef0dedba8">starkEx deep dive</a></li>
<li>[coset] <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Coset">https://en.wikipedia.org/wiki/Coset</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/starkware/arithmetization-ii-403c3b3f4355">starkware math</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/11/03/cryptography/zkp/stark-101/" data-id="clphpvdoj0005aj7ug6vbhr5l" data-title="stark 101" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cryptography/" rel="tag">cryptography</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zkp/" rel="tag">zkp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-cryptography/zkp/understanding-plonk" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/01/cryptography/zkp/understanding-plonk/" class="article-date">
  <time class="dt-published" datetime="2023-11-01T09:19:04.000Z" itemprop="datePublished">2023-11-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/01/cryptography/zkp/understanding-plonk/">understanding plonk</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript">
</script>

<h1 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h1><p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2019/953">PLONK</a>, standing for the unwieldy quasi-backronym “Permutations over Lagrange-bases for Oecumenical Noninteractive arguments of Knowledge”. PLONK still requires a “universal and updateable” trusted setup, meaning each program share the same setup. Secondly, there is a way for multiple parties to participate in the trusted setup such that it is secure as long as any one of them is honest.</p>
<h1 id="preliminary"><a href="#preliminary" class="headerlink" title="preliminary"></a>preliminary</h1><h2 id="observation-1"><a href="#observation-1" class="headerlink" title="observation 1"></a>observation 1</h2><p>a key fact: for non-zero \( f \in \mathbb{F_p}^{\le d}[X]\) <br><br>for \( r  \leftarrow \mathbb{F_p}: Pr[f(r) &#x3D; 0] \le d&#x2F;p\)<br>understanding: polynomial \(f\) contains at most \(d\) roots of zeros. <br><br>suppose \( p \approx 2^{256}\) and  \( d \approx 2^{40}\) then \(d&#x2F;p\) is negligible. <br><br>Therefore, for random \( r  \leftarrow \mathbb{F_p}\) if \(f(r) &#x3D; 0\) then \(f\) is identically zero w.h.p (with high probability)</p>
<p>&#x3D;&gt; a simple zero test for a committed polynomial<br><strong>Note</strong> SZDL lemma: this also holds for multivariate polynomials (where d is total degree of f) </p>
<h2 id="observation-2"><a href="#observation-2" class="headerlink" title="observation 2"></a>observation 2</h2><p>let \(f,g \in \mathbb{F_p}^{\le d}[X]\).<br>for \( r  \leftarrow \mathbb{F_p}\), if \(f(r) &#x3D; g(r)\), then \(f &#x3D; g\) w.h.p <br><br>\(f(r)-g(r)&#x3D;0\) &#x3D;&gt; \(f-g&#x3D;0\) w.h.p <br></p>
<p>&#x3D;&gt; a simple equality test for two committed polynomials</p>
<h1 id="useful-proof-gadgets"><a href="#useful-proof-gadgets" class="headerlink" title="useful proof gadgets"></a>useful proof gadgets</h1><h2 id="1-zero-test"><a href="#1-zero-test" class="headerlink" title="1. zero test"></a>1. zero test</h2><p>let \( \omega \in \mathbb{F_p} \) be a primitive k-th root of unity \(( \omega ^{k} &#x3D; 1)\)<br>set \( H:&#x3D; \{1,\omega,\omega^2,\omega^3,…,\omega^{k-1}\}  \subseteq \mathbb{F_p} \)<br>let \( f \in \mathbb{F_p}^{\le d}[X]\) and \( b, c \in \mathbb{F_p}\)  \((d \ge k)\)</p>
<p>task: prove that \(f\) is identically zero on \(H\)<br><img src="/images/zkp/plonk/zero_test.png" alt="zero test"></p>
<p><strong>info</strong> the box of \(f\) means the commitment of polynomial \(f\), i.e \(com_f\)</p>
<h2 id="2-product-check"><a href="#2-product-check" class="headerlink" title="2. product check"></a>2. product check</h2><p>product check on \(\Omega: \quad \prod_{a\in \Omega} f(a) &#x3D; 1\)<br>Set \( t \in \mathbb{F_p}^{\le k}[X]\) to be the degree-k polynomial:<br>\[ t(1) &#x3D; f(\omega^0) &#x3D; f(1), \quad t(\omega^s) &#x3D; \prod_{i&#x3D;0}^{s}f(\omega^{i}) \quad for \quad s &#x3D; 1,…, k-1\]<br>Then<br>\(t(\omega) &#x3D; f(1) \cdot f(\omega), \quad t(\omega^2) &#x3D; f(1) \cdot f(\omega) \cdot f(\omega^2), … \)<br>\(t( \omega^{k-1}) &#x3D; \prod_{a \in \Omega}f(a) &#x3D; 1\)<br>and \( t(\omega \cdot x) &#x3D; t(x) \cdot f(\omega \cdot x) \) for all \(x \in \Omega \) (including at \(x &#x3D; \omega^{k-1}\))<br><img src="/images/zkp/plonk/prod_check_lemma.png" alt="prod_check_lemma"><br><img src="/images/zkp/plonk/prod_check_prove_verify.png" alt="prod_check_prove_and_verify"></p>
<p>Same works for rational functions: \( \prod_{a \in \Omega}{f&#x2F;g}(a) &#x3D;1 \)<br>The proof is similar</p>
<h2 id="3-permutation-check"><a href="#3-permutation-check" class="headerlink" title="3. permutation check"></a>3. permutation check</h2><p>let \(f,g\) be polynomials in \(\mathbb{F_p}^{\le d}[X]\). Verifier has \(com_f, com_g\).<br>Prover wants to prove that \((f(1),f(\omega^1),f(\omega^2),…,f(\omega^{k-1})) \in \mathbb{F_p}^{\le k}[X]\) is a permutaion of \((g(1),g(\omega^1),g(\omega^2),…,g(\omega^{k-1})) \in \mathbb{F_p}^{\le k}[X]\)</p>
<p><img src="/images/zkp/plonk/permutation_check.png" alt="permutation check"></p>
<h2 id="4-prescribed-permutation-check"><a href="#4-prescribed-permutation-check" class="headerlink" title="4. prescribed permutation check"></a>4. prescribed permutation check</h2><p><img src="/images/zkp/plonk/prescribed_perm_check_problem.png"><br><img src="/images/zkp/plonk/prescribed_perm_check_problem_quadratic.png"><br><img src="/images/zkp/plonk/prescribed_perm_check_problem_reduce.png"><br><img src="/images/zkp/plonk/prescribed_perm_check_problem_prove_verify.png"><br><img src="/images/zkp/plonk/prescribed_perm_check_problem_complete.png"></p>
<h1 id="PLONK-a-poly-IOP-for-a-general-circuit-C-x-w"><a href="#PLONK-a-poly-IOP-for-a-general-circuit-C-x-w" class="headerlink" title="PLONK: a poly-IOP for a general circuit C(x,w)"></a>PLONK: a poly-IOP for a general circuit C(x,w)</h1><h2 id="step-1-compile-circuit-to-a-computation-trace-gate-fan-in-x3D-2"><a href="#step-1-compile-circuit-to-a-computation-trace-gate-fan-in-x3D-2" class="headerlink" title="step 1: compile circuit to a computation trace (gate fan-in &#x3D; 2)"></a>step 1: compile circuit to a computation trace (gate fan-in &#x3D; 2)</h2><p><img src="/images/zkp/plonk/plonk_circuit_to_trace.png" alt="circuit to trace"></p>
<p>and encode the trace as polynomial<br>let \(|C|\) be the total number of gates, \(|I| :&#x3D; |I_x| + |I_w|\) be total number of inputs, where \(|I_x|\) is the number of public inputs, \(I_w\) is the number of private inputs.<br>Let \(d&#x3D;3*|C|+|I|\) and \( \Omega&#x3D;\{1,\omega,\omega^2,\omega^3,…,\omega^{d-1}\} \)</p>
<p>prover interpolates \( T \in \mathbb{F_p}^{\le d}[X]\) such that</p>
<ul>
<li><strong>T encodes all inputs</strong>: \( T(\omega^{-j})  \)&#x3D; input #j, for j &#x3D; 1,…,|I|</li>
<li><strong>T encodes all wires</strong>:<br>\(LeftInput&#x3D;f(\omega^{3l})\), \(  RightInput&#x3D;f(\omega^{3l+1})\), \(Output&#x3D;f(\omega^{3l+2})\), for \(l &#x3D; 0,1,…, |C| -1\)<br>For the example,<br><strong>inputs</strong><br>\(x_1&#x3D; 5 &#x3D; T(\omega^9)\), \(x_2&#x3D; 6 &#x3D; T(\omega^{10})\), and \(w_1 &#x3D; 1&#x3D;T(\omega^{11})\)<br><strong>wires</strong><br>\(5&#x3D;T(\omega^0)\), \(6&#x3D;T(\omega^{1})\), and \(11&#x3D;T(\omega^{2})\)<br>\(6&#x3D;T(\omega^3)\), \(1&#x3D;T(\omega^{4})\), and \(7&#x3D;T(\omega^{5})\)<br>\(11&#x3D;T(\omega^6)\), \(7&#x3D;T(\omega^{7})\), and \(77&#x3D;T(\omega^{8})\)</li>
</ul>
<h2 id="step-2-proving-validity-of-T"><a href="#step-2-proving-validity-of-T" class="headerlink" title="step 2: proving validity of T"></a>step 2: proving validity of T</h2><p>Prover needs to prove 4 things</p>
<ol>
<li><strong>\(T(x)\) encodes the correct public inputs</strong><br>Both prover and verifier interpolate a polynomial \( v(x) \in \mathbb{F_p}^{\le |I_x|}[X]\)<br>that encodes the \(x\)-inputs to the circuit:<br>\(v(\omega^{-j}) &#x3D;\) input #j, for \(j &#x3D; 1, …, |I_x|\)<br>In our example, \(v(\omega^{-1} &#x3D; 5), v(\omega^{-2} &#x3D; 6)\)<br>Let \( \Omega_{inp}&#x3D;\{\omega^{-1},\omega^{-2},…,\omega^{-|I_x|}\} \)<br>Prover proves by using a <strong>ZeroTest</strong> on \(\Omega_inp\) to prove that<br>\[T(y) - v(y) &#x3D;0 \quad \forall y \in \Omega_{inp}\]</li>
<li><strong>every gate is evaluated correctly</strong><br><strong>Idea</strong> encode gate types using a selector polynomial \(S(X)\)<br>define \(S(X) \in  \mathbb{F_p}^{\le d}[X]\) such that \( \forall l &#x3D; 0, …, |C| -1\):</li>
</ol>
<ul>
<li>\(S(\omega^{3l}) &#x3D;1\) if gate #l is an addition gate</li>
<li>\(S(\omega^{3l}) &#x3D;0\) if gate #l is a multiplication gate</li>
</ul>
<p>Then, \( \forall y \in   \Omega_{gates} : &#x3D; \{1,\omega^{3},\omega^{6},…,\omega^{3(|C|-1)}\} \)<br>\(S(y) \cdot [T(y) + T(\omega y)] + (1-S(y))\cdot T(y) \cdot T(\omega y) &#x3D; T(\omega^2 y)\)<br><img src="/images/zkp/plonk/gate_evaluation_zero_test.png" alt="gate_evaluation_zero_test"></p>
<ol start="3">
<li><strong>the wiring is implemented correctly (coppy constraint)</strong><br><img src="/images/zkp/plonk/copy_constraint_example.png"></li>
</ol>
<p>  \(T(\omega^9,\omega^0)&#x3D;\sigma(\omega^0,\omega^9)\)<br>  \(T(\omega^{10},\omega^1,\omega^3)&#x3D;\sigma(\omega^1,\omega^3,\omega^{10})\)<br>  \(T(\omega^2,\omega^6)&#x3D;\sigma(\omega^6,\omega^2)\)<br>  \(T(\omega^{11},\omega^4)&#x3D;\sigma(\omega^4,\omega^{11})\)<br>    \(T(\omega^{5},\omega^7)&#x3D;\sigma(\omega^7,\omega^{5})\)<br><strong>note</strong>: 9 is actually -1, 10 is -2, 11 is -3<br>Define a polynomial \(W: \Omega -&gt; \Omega\) that implemnets a rotation<br>\( W(\omega^{10}, \omega^1, \omega^3) &#x3D;(\omega^1, \omega^3, \omega^{10}) \), \(W(\omega^{9}, \omega^0)&#x3D;(\omega^0, \omega^{9})\), …</p>
<p><strong>Lemma</strong>: \(\forall y \in \Omega: T(y) &#x3D; T(W(y))\) &#x3D;&gt; wire constraints are satisfied<br>This could be proved using a prescribed permutation check</p>
<ol start="4">
<li><strong>the output of last gate is 0</strong><br>this is to prove \(T(\omega^8) -77 &#x3D; 0\)</li>
</ol>
<h1 id="custom-gate"><a href="#custom-gate" class="headerlink" title="custom gate"></a>custom gate</h1><p><img src="/images/zkp/plonk/custom_gate.png"><br>\(u, v, w, t, r\) are polynomials represent input variables (row number is the gate number). in the <code>Add</code>, <code>Mul</code> only circuits, there are only two inputs, namely <code>LeftInput</code> and <code>RightInput</code>. Hoever, here there are multiple inputs for custom gate. </p>
<p>In the above example, it is a constraint for \( v_4 + w_3 \cdot t_3 - t_4 &#x3D; 0 \)</p>
<h1 id="plonkup"><a href="#plonkup" class="headerlink" title="plonkup"></a>plonkup</h1><p>plonkup is to ensure some values are in a pre-defined list. for example</p>
<table>
<thead>
<tr>
<th>x1</th>
<th>x2</th>
<th>x3</th>
<th>Output</th>
</tr>
</thead>
<tbody><tr>
<td>\(a_{1,1}\)</td>
<td>\(a_{1,2}\)</td>
<td>\(a_{1,3}\)</td>
<td>\(a_{1,4}\)</td>
</tr>
<tr>
<td>\(a_{2,1}\)</td>
<td>\(a_{2,2}\)</td>
<td>\(a_{2,3}\)</td>
<td>\(a_{2,4}\)</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr>
<td>\(a_{n,1}\)</td>
<td>\(a_{n,2}\)</td>
<td>\(a_{n,3}\)</td>
<td>\(a_{n,4}\)</td>
</tr>
</tbody></table>
<p>\(n\) is gate number. the task is to prove a vector </p>
<h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><ul>
<li><a target="_blank" rel="noopener" href="https://hackmd.io/@learn-zkp/note-plonk-family">https://hackmd.io/@learn-zkp/note-plonk-family</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=A0oZVEXav24">ZKP MOOC Lecture 5: The Plonk SNARK</a></li>
<li><a target="_blank" rel="noopener" href="https://cs251.stanford.edu/lectures/lecture15.pdf">CS251.stanford lecture</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/11/01/cryptography/zkp/understanding-plonk/" data-id="clphpvdok000baj7u3i3te2rg" data-title="understanding plonk" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cryptography/" rel="tag">cryptography</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zkp/" rel="tag">zkp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-blockchain/danksharding" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/10/12/blockchain/danksharding/" class="article-date">
  <time class="dt-published" datetime="2023-10-12T06:36:58.000Z" itemprop="datePublished">2023-10-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/10/12/blockchain/danksharding/">danksharding</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript">
</script>

<h2 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h2><p>Danksharding is central to Ethereum’s rollup-centric roadmap. The idea is to provide space for large blobs of data, which are verifiable and available, without attempting to interpret them.</p>
<h2 id="Preliminaries"><a href="#Preliminaries" class="headerlink" title="Preliminaries"></a>Preliminaries</h2><p>All references to EC, in this report, refer to BLS12_381 [1]. We are mainly concerned with the EC Abelian-group \(\mathbb{G_{1}}\) and the EC scalar-field \(F_r\). Both are of size \(r &lt; 2256\). Note that \(2^{32}\) divides the size of the multiplicative-group in \(F_r\)</p>
<h2 id="Data-organization"><a href="#Data-organization" class="headerlink" title="Data organization"></a>Data organization</h2><p>The input data consists of n &#x3D; 256 shard-blobs. Each shard-blob is a vector of m &#x3D; 4096 field-elements referred-to as symbols. The data symbols are organized in an n × m input<br>matrix<br>\[<br>    \tag{1}<br>    D_{n x m}^{in} &#x3D;<br>\begin{bmatrix}<br>\displaylines{<br>    d(0,0)   &amp; d(0,1)  &amp; \dots  &amp; d(0,m-1)\\<br>    d(1,0)   &amp; d(1,1)  &amp; \dots  &amp; d(1,m-1)\\<br>    \vdots                 &amp; \vdots                 &amp; \ddots &amp; \vdots\\<br>    d(n-1,0)   &amp; d(n-1,1)  &amp; \dots  &amp; d(n-1,m-1)<br>}<br>\end{bmatrix}<br>\]<br>where each row is one of the shard-blob vectors [2]<br>In order to enable interpolation and polynomial-commitment to the data, we will pro-<br>ceed to treat the data symbols as polynomial evaluations.</p>
<p>Let us thus associate each domain location in the input matrix with a field-element pair \(u_{\mu}, \omega_{\eta}\), where \(\mu \in [0, n−1], \eta \in [0, m−1]\) correspond to the row and column indexes, respectively.The row field-element is defined as \( u_{\mu} \equiv u^{rbo(\mu)}\), where u is a 2n’th root-of-unity such that \(u^{2n} &#x3D; 1\). The column field-element is defined as \( \omega_{\eta} \equiv \omega^{rbo(\eta)}\), where \(\omega\) is a 2m’th root-of-unity such that \(\omega^{2m} &#x3D; 1\). <span style="color:red"><em>Using reverse-bit-order ordering rather than natural-ordering allows accessing cosets in block (consecutive) rather than interleaved manner</em></span></p>
<h2 id="coefficients-extraction"><a href="#coefficients-extraction" class="headerlink" title="coefficients extraction"></a>coefficients extraction</h2><p>Taking the data symbols to be evaluations of a 2D-polynomial or 1D-product-polynomials with row degree n−1 and column degree m−1 uniquely defines the polynomials’ coefficients.</p>
<h3 id="2D-coeficients-extraction"><a href="#2D-coeficients-extraction" class="headerlink" title="2D coeficients extraction"></a>2D coeficients extraction</h3><p>The 2D-polynomial representing the input data can be expressed as<br>\[\tag{2} d(x,y) \equiv \sum_{i&#x3D;0}^{n-1}\sum_{j&#x3D;0}^{m-1} \hat{c}[i,j] x^{i}y^{j}\]<br>Plugging an evaluation from (1) into (2) results in the following:</p>
<p>\[\tag{3} d(u_{\mu},\omega_{\eta}) \equiv \sum_{i&#x3D;0}^{n-1}\sum_{j&#x3D;0}^{m-1} \hat{c}[i,j] {u_{\mu}}^{i}{\omega_{\eta}}^{j}\]</p>
<h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><p>[1] Ben Edgington. Bls12-381 for the rest of us. <a target="_blank" rel="noopener" href="https://hackmd.io/@benjaminion/bls12-381">https://hackmd.io/@benjaminion/bls12-381</a>.<br>[2] Dankrad Feist. Data availability encoding. <a target="_blank" rel="noopener" href="https://notes.ethereum.org/@dankrad/danksharding_encoding">https://notes.ethereum.org/@dankrad/danksharding_encoding</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/10/12/blockchain/danksharding/" data-id="clokyy8dm0005qwsja95zaawe" data-title="danksharding" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blockchain/" rel="tag">blockchain</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-math/fourier-series" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/10/12/math/fourier-series/" class="article-date">
  <time class="dt-published" datetime="2023-10-12T03:13:17.000Z" itemprop="datePublished">2023-10-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/10/12/math/fourier-series/">fourier series, DFT and FFT</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript">
</script>

<h2 id="Fourier-Series"><a href="#Fourier-Series" class="headerlink" title="Fourier Series"></a>Fourier Series</h2><h3 id="innter-product-of-two-functions"><a href="#innter-product-of-two-functions" class="headerlink" title="innter product of two functions"></a>innter product of two functions</h3><p>\[ &lt;f(x), g(x)&gt; &#x3D; \int_{a}^{b} f(x) \bar{g}(x)dx\]<br>\(\bar{g}\) is the congugate of g on complex number system</p>
<h3 id="Fourier-series-definition"><a href="#Fourier-series-definition" class="headerlink" title="Fourier series definition"></a>Fourier series definition</h3><p>let \(f(x)\) be a periodic function over a period of \([-\pi, +\pi]\)<br><img src="/images/math/fourier_series/f_x.png" alt="f(x)"></p>
<p>\( f(x) \) can be transformed into below<br>\[ f(x) &#x3D; \frac{A_{0}}{2} + \sum_{k&#x3D;1}^{\infty}A_{k}cos(kx) + B_{k}sin(kx)\],<br>where<br>\[ A_{k} &#x3D; \frac{1}{\pi} \int_{-\pi}^{+\pi} f(x)cos(kx)dx &#x3D; \frac{1}{||cos(kx)||^2}&lt;f(x),cos(kx)&gt; \]<br>\[ B_{k} &#x3D; \frac{1}{\pi} \int_{-\pi}^{+\pi} f(x)sin(kx)dx &#x3D; \frac{1}{||sin(kx)||^2}&lt;f(x),sin(kx)&gt; \]<br>where \(A_{k}, B_{k}\) is just the <strong>innver product</strong> of \(f(x)\), and \( cos(kx) \), \(sin(kx)\) respectively. intuitively, it is the <strong>projection</strong> of \(f(x)\) over \(sin(kx)\), or \(cos(kx)\). </p>
<h3 id="if-period-is-L"><a href="#if-period-is-L" class="headerlink" title="if period is L"></a>if period is L</h3><p>\[ f(x) &#x3D; \frac{A_{0}}{2} + \sum_{k&#x3D;1}^{\infty}A_{k}cos(\frac{2\pi kx}{L}) + B_{k}sin(\frac{2\pi kx}{L})\],<br>where<br>\[ A_{k} &#x3D; \frac{2}{L} \int_{0}^{L} f(x)cos(\frac{2\pi kx}{L})dx\]<br>\[ B_{k} &#x3D; \frac{2}{L} \int_{0}^{L} f(x)sin(\frac{2\pi kx}{L})dx\]</p>
<h2 id="Complex-Fourier-Series"><a href="#Complex-Fourier-Series" class="headerlink" title="Complex Fourier Series"></a>Complex Fourier Series</h2><p>let’s define \[ \psi_k &#x3D; e^{ikx} &#x3D; cos(kx) + i \cdot sin(kx)\]<br>we can prove that \(\psi_k, and \psi_j\) are <strong>orthogonal</strong> as their inner product is zero<br><strong>proof</strong><br>\[ &lt;\psi_j, \psi_k&gt; &#x3D; \int_{-\pi}^{+\pi} e^{jkx}e^{-ikx}dx &#x3D;  \int_{-\pi}^{+\pi} e^{j(j-k)x}dx &#x3D; \frac{1}{i(j-k)}[e^{i(j-k)x}]_{-\pi}^{\pi}\]<br>it is 0 if \(j \ne k\) , \(2\pi \) if \(j&#x3D;k\)</p>
<p><strong>note</strong> conjugate of \(\psi_k\) is \(e^{-ikx}\)</p>
<p>\(f(x) &#x3D; \frac{1}{2\pi} \sum_{k&#x3D;-\infty}^{\infty} c_k \psi_k\), where \(c_k&#x3D;&lt;f(x), \psi_k&gt; &#x3D; \int_{-\pi}^{+\pi} f(x)e^{-ikx}dx\)</p>
<h2 id="Discrete-Fourier-Transform-DFT"><a href="#Discrete-Fourier-Transform-DFT" class="headerlink" title="Discrete Fourier Transform (DFT)"></a>Discrete Fourier Transform (DFT)</h2><p>The discrete Fourier transform transforms a sequence of N complex numbers<br>\[\lbrace x_{n} \rbrace :&#x3D; x_0, x_1,…, x_{N-1} \] into another sequence of complex numbers,<br>\[\lbrace X_{k} \rbrace :&#x3D; X_0, X_1,…, X_{N-1} \] which is defined by<br>\[X_{k} &#x3D; \sum_{n&#x3D;0}^{N-1} x_{n} \cdot e^{-\frac{i2\pi}{N}kn}\]</p>
<p>let the n-th root of unity be \(\omega_N &#x3D; e^{-\frac{2\pi i}{N}}\), we have<br>\[ \tag{1.1} X_{k} &#x3D; \sum_{n&#x3D;0}^{N-1} x_{n} \cdot \omega_N^{kn}\]</p>
<h3 id="inverse-DFT"><a href="#inverse-DFT" class="headerlink" title="inverse DFT"></a>inverse DFT</h3><p>The inverse transform is given by<br>\[ \tag{1.2} x_{n} &#x3D; \frac{1}{N}\sum_{k&#x3D;0}^{N-1} X_{k} \cdot \omega_N^{-kn}\]</p>
<h3 id="the-unitary-DFT"><a href="#the-unitary-DFT" class="headerlink" title="the unitary DFT"></a>the unitary DFT</h3><p>Another way of looking at the DFT is to note that the DFT can be expressed as the DFT matrix, a Vandermonde matrix, introduced by Sylvester in 1867.<br>\[<br>    \boldsymbol{F} &#x3D;<br>\begin{bmatrix}<br>\displaylines{<br>    \omega_{N}^{0\cdot0}   &amp; \omega_{N}^{0\cdot1}   &amp; \dots  &amp; \omega_{N}^{0\cdot (N-1)}\\<br>    \omega_{N}^{1\cdot0}   &amp; \omega_{N}^{1\cdot1}   &amp; \dots  &amp; \omega_{N}^{2\cdot (N-1)}\\<br>    \vdots                 &amp; \vdots                 &amp; \ddots &amp; \vdots\\<br>    \omega_{N}^{N-1\cdot0} &amp; \omega_{N}^{N-1\cdot1} &amp; \dots  &amp; \omega_{N}^{N-1\cdot (N-1)}<br>}<br>\end{bmatrix}<br>\]<br>where \( \omega_{N} &#x3D; e^{-\frac{i2\pi}{N}}\) is a primitive Nth root of unity. (any complex number that yields 1 when raised to some positive integer power n)</p>
<p>\[ X &#x3D; F \cdot x^{T}\]<br>\(x\) is a column vector</p>
<h2 id="Polynomial-amp-DFT"><a href="#Polynomial-amp-DFT" class="headerlink" title="Polynomial &amp; DFT"></a>Polynomial &amp; DFT</h2><h3 id="Polynomial-evaluation-amp-DFT"><a href="#Polynomial-evaluation-amp-DFT" class="headerlink" title="Polynomial evaluation &amp; DFT"></a>Polynomial evaluation &amp; DFT</h3><p>let a polynomial be<br>$$f(x)&#x3D;\sum_{n&#x3D;0}^{N-1}x_nx^n$$<br>then,<br>$$f(\omega_N^{k})&#x3D;\sum_{n&#x3D;0}^{N-1}x_n\omega_N^{kn},\quad k&#x3D;0,1,2,…,N-1$$<br>compare this equation with E.q(1.1), we can know that DFT is the evaluations of a polynomial at N points of Nth root of unity, \(\omega_N^{0},\omega_N^1,\omega_N^2,…,\omega_N^{N-1}\)</p>
<p>$$(\omega_N^{0},X_0),(\omega_N^1,X_1),(\omega_N^2,X_2),…,(\omega_N^{N-1},X_{N-1})$$</p>
<h3 id="Polynomial-interpolation-amp-IDFT"><a href="#Polynomial-interpolation-amp-IDFT" class="headerlink" title="Polynomial interpolation &amp; IDFT"></a>Polynomial interpolation &amp; IDFT</h3><p>According to E.q(1.2), IDFT is the polynomial interpolation (getting original polynomial coefficients).</p>
<h2 id="Fast-Fourier-Transform-FFT-3"><a href="#Fast-Fourier-Transform-FFT-3" class="headerlink" title="Fast Fourier Transform (FFT) [3]"></a>Fast Fourier Transform (FFT) [3]</h2><p>The problem is to calculate the below<br>\[ \tag{2.1} X_{k} &#x3D; \sum_{n&#x3D;0}^{N-1} x_{n} \cdot \omega_N^{kn}, \quad  k&#x3D; 0,1,…,N-1\]<br>A straightforward calculation using would require \(N^2\) operations where “operation” means, as it will throughout this note, a complex multiplication followed by a complex addition.<br>The FFT algorithm described here iterates on the array and yields the result in less than \( 2N log_2N \)</p>
<p>To derive the algorithm, suppose \(N\) is a composite, i.e., \(N &#x3D; r_1\cdot r_2\). Then let the indices in (2.1) be expressed<br>\[ k &#x3D; k_1r_1 + k_0, \quad k_0 &#x3D; 0,1,…,r_1-1, \quad k_1 &#x3D; 0,1,…, r_2 -1 \]<br>\[ n &#x3D; n_1r_2 + n_0, \quad n_0 &#x3D; 0,1,…,r_2-1, \quad n_1 &#x3D; 0,1,…, r_1 -1 \]</p>
<p>Since \(  n &#x3D; n_1r_2 + n_0\), we can write</p>
<p>\[ \tag{2.2} X(k_1, k_0) &#x3D; \sum_{n_0} \sum_{n_1}x(n_1,n_0)\omega_N^{kn} &#x3D; \sum_{n_0} \sum_{n_1}x(n_1,n_0)\omega_N^{kn_1r_2}\omega_N^{kn_0}  \]<br><strong>note</strong> \( x(n_1,n_0)\) is same to \(x(n)\), just the indexing is transformed form 1D to 2D. You can think original 1D array of size N is resized to a matrix of size \( (r_2, r_1) \), \(r_1\) is number of cols, while \(r_2\) is number of rows</p>
<p>Since \(k &#x3D; k_1r_1 + k_0\), we have<br>\[ \omega_N^{kn_1r_2} &#x3D;\omega_N^{(k_1r_1+k_0)n_1r_2} &#x3D; \omega_N^{(k_1r_1)n_1r_2} \cdot \omega_N^{k_0n_1r_2}\]<br>according to the property of Nth root of unity, \( \omega_N^{N} &#x3D; \omega_N^{r_1r_2} &#x3D;1 \), \( \omega_N^{(k_1r_1)n_1r_2}\) is also 1.<br>then we have<br>\[ \omega_N^{kn_1r_2} &#x3D;  \omega_N^{k_0n_1r_2}\]<br>substitute it into E.q 2.2, we get<br>\[ \tag{2.3} X(k_1, k_0) &#x3D; \sum_{n_0} \sum_{n_1}x(n_1,n_0)\omega_N^{kn} &#x3D; \sum_{n_0} \sum_{n_1}x(n_1,n_0)\omega_N^{k_0n_1r_2}\omega_N^{kn_0}  \]<br>Therefore, the inner sum, over \(n_1\), depends only on \(k_0\) and \(n_0\), and can be defined as a new array,<br>\[ \tag{2.4} x_1(k_0, n_0) &#x3D; \sum_{n_1} x(n_1, n_0) \cdot \omega_N^{k_0n_1r_2}\]<br>E.q(2.3) can be writtern as<br>\[ \tag{2.5} X(k_1, k_0) &#x3D; \sum_{n_0} x_1(k_0,n_0)\omega_N^{kn_0} &#x3D;  \sum_{n_0} x_1(k_0,n_0)\omega_N^{(k_1r_1 + k_0)n_0}  \]</p>
<p>There are N elements in the matrix \(x_1\), each requiring \(r_1\) operations, giving a total of \(Nr_1\) operations. Similarly, it takes \(Nr_2\) operations to calculate \(X\) from \(x_1\). Therefore, the two-step algorithm, given by Eq(2.4) and Eq(2.5) requires a total of<br>\[ \tag{2.6} T &#x3D; N(r_1+r_2) \]</p>
<p>it is easy to see how successive applications of the above procedure (recursively),  starting with its appliation to Eq(2.4) give an m-step algorihtm requiring<br>\[ \tag{2.7} T &#x3D; N(r_1+r_2 + … + r_m) \]<br>where<br>\[ N &#x3D; \prod_{j&#x3D;1}^{j&#x3D;m}r_j\]<br>if all \(r_j\) are equal to \(r\), i.e \(N &#x3D; r^m \), which gives \( m &#x3D; log_rN \)<br>E.q(2.7) becomes<br>\[ \tag{2.8} T &#x3D; N(m \cdot r)  &#x3D; rNm &#x3D; rN(log_rN) \]</p>
<h2 id="radix-2-FFT"><a href="#radix-2-FFT" class="headerlink" title="radix-2 FFT"></a>radix-2 FFT</h2><p>The algorithm with \(r&#x3D;2\) is derived by expressing the indices in the form</p>
<p>\[\tag{3.1} k&#x3D;k_{m-1} \cdot 2^{m-1} + … + k_1 \cdot 2 + k_0 \]<br>\[\tag{3.2} n&#x3D;n_{m-1} \cdot 2^{m-1} + … + n_1 \cdot 2 + n_0 \]<br>where \( k_v \in [0,1] \), for \( v &#x3D; 0,…,m-1 \), and \( n_v \in [0,1] \), for \( v &#x3D; 0,…,m-1 \)<br><strong>\(k_v\) and \(n_v\) are the contents of the respective bit positions in the binary representation of \(k\) and \(n\)</strong></p>
<p>All arrays will now be written as functions of the bits of their indices. With this convention E.q(2.1) is written as<br>\[ \tag{3.3}<br>\displaylines{<br>  X(k_{m-1}, …, k_0) &#x3D; \sum_{n_0}\sum_{n_1} … \sum_{n_{m-1}} x(n_{m-1}, …,n_1, n_0) \cdot \omega_N^{kn} \\<br>  &#x3D; \sum_{n_0}\sum_{n_1} … \sum_{n_{m-1}} x(n_{m-1}, …,n_1, n_0) \cdot \omega_N^{k(n_{m-1} \cdot 2^{m-1} + … + n_1 \cdot 2 + n_0)} \\<br>  &#x3D; \sum_{n_0}\sum_{n_1} … \sum_{n_{m-1}} x(n_{m-1}, …,n_1, n_0) \cdot \omega_N^{kn_{m-1} \cdot 2^{m-1} + … + kn_1 \cdot 2 + kn_0}<br>}<br>\]<br>where the sums are over \(n_v \in [0,1]\), for \(v &#x3D; 0,1,…,m-1\)</p>
<p>Since \[ \displaylines{<br>  \omega_N^{kn_{m-1}\cdot 2^{m-1}} &#x3D; \omega_N^{(k_{m-1} \cdot 2^{m-1} + … + k_1 \cdot 2 + k_0)n_{m-1}\cdot 2^{m-1}} \\<br>  &#x3D; \omega_N^{k_0 n_{m-1} \cdot 2^{m-1}}<br>}<br>  \]<br>(it is easy to show that all other terms are 1 as \( \omega_N^{2^m} &#x3D; 1 \), so only \( k_0\) is kept)</p>
<p>the innermost sum of E.q(3.3) over \(n_{m-1} \), depends only on \( k_0, n_{m-2}, …, n_0\) and can be writtern<br>\[ \displaylines{<br>x_1(k_0, n_{m-2}, …, n_1, n_0) &#x3D; \sum_{n_{m-1}} x(n_{m-1}, …, n_0) \cdot \omega_N^{k_0 n_{m-1} \cdot 2^{m-1}}<br>}<br>  \]</p>
<p>proceeding to the next innermost sum, over \( n_{m-2} \), and so on, and using<br>\[ \displaylines{<br>  \omega_N^{kn_{m-l}\cdot 2^{m-l}} &#x3D; \omega_N^{(k_{m-1} \cdot 2^{m-1} + … + k_1 \cdot 2 + k_0)n_{m-l}\cdot 2^{m-l}} \\<br>  &#x3D; \omega_N^{(k_{l-1}\cdot 2^{l-1} + … + k_0) n_{m-l} \cdot 2^{m-1}}<br>}<br>  \]<br>one obtains successive arrays<br>\[\displaylines{<br>x_l(k_0, …, k_{l-1}, n_{m-l-1}, … , n_0)   \\<br>&#x3D; \sum_{n_{m-l}}x_{l-1}(k_0, …, k_{l-2}, n_{m-l}, …, n_0 ) \cdot \omega_N^{(k_{l-1}\cdot 2^{l-1} + …+ k_0) \cdot n_{m-l} \cdot 2^{m-l}}<br>}\]<br>for \(l &#x3D; 1,2,…,m \)</p>
<p>writing out the sum this appears as<br>\[  \tag{3.4} \displaylines{<br>x_l(k_0, …, k_{l-1}, n_{m-l-1}, … , n_0)   \\<br>&#x3D; x_{l-1}(k_0, …, k_{l-2}, 0, n_{m-l -1}, …, n_0 ) \cdot \omega_N^{(k_{l-1}\cdot 2^{l-1} + …+ k_0) \cdot 0 \cdot 2^{m-l}}   \\<br>+ x_{l-1}(k_0, …, k_{l-2}, 1, n_{m-l -1}, …, n_0 ) \cdot \omega_N^{(k_{l-1}\cdot 2^{l-1} + …+ k_0) \cdot 1 \cdot 2^{m-l}}  \\<br>&#x3D; x_{l-1}(k_0, …, k_{l-2}, 0, n_{m-l -1}, …, n_0 ) \\<br>+ x_{l-1}(k_0, …, k_{l-2}, 1, n_{m-l-1}, …, n_0 ) \cdot \omega_N^{(k_{l-1}\cdot 2^{l-1} + k_{l-2}\cdot 2^{l-2 }+k_{l-3}\cdot 2^{l-3} + …+ k_0) \cdot 2^{m-l}} \\<br>&#x3D; x_{l-1}(k_0, …, k_{l-2}, 0, n_{m-l -1}, …, n_0 ) \\<br>+ \omega_N^{k_{l-1}\cdot 2^{l-1} \cdot 2^{m-l} } \cdot \omega_N^{k_{l-2}\cdot 2^{l-2 } \cdot 2^{m-l}} \cdot x_{l-1}(k_0, …, k_{l-2}, 1, n_{m-l-1}, …, n_0 ) \cdot \omega_N^{(k_{l-3}\cdot 2^{l-3} + …+ k_0) \cdot 2^{m-l}} \\<br>&#x3D; x_{l-1}(k_0, …, k_{l-2}, 0, n_{m-l -1}, …, n_0 ) \\<br>+ \omega_N^{k_{l-1}\cdot 2^{m-1} } \cdot \omega_N^{k_{l-2}\cdot 2^{m-2}} \cdot x_{l-1}(k_0, …, k_{l-2}, 1, n_{m-l-1}, …, n_0 ) \cdot \omega_N^{(k_{l-3}\cdot 2^{l-3} + …+ k_0) \cdot 2^{m-l}} \\<br>&#x3D; x_{l-1}(k_0, …, k_{l-2}, 0, n_{m-l -1}, …, n_0 ) \\<br>+ (-1)^{k_{l-1} } \cdot i^{k_{l-2}} \cdot x_{l-1}(k_0, …, k_{l-2}, 1, n_{m-l-1}, …, n_0 ) \cdot \omega_N^{(k_{l-3}\cdot 2^{l-3} + …+ k_0) \cdot 2^{m-l}}<br>}\]<br>according to the indexing convension, this is stored in a location whose index is<br>\[ k_0 \cdot 2^{m-1} + … + k_{l-1} \cdot 2 ^{m-l} + n_{m-l-1} \cdot 2^{m-l-1} + … + n_0 \]</p>
<p>It can be seen in E.q(3.4) that only the two storage locations with indices having 0 and 1 in the \(2^{m-l}\) bit position are involved in the computation. Parallel computation is permitted since the operation described by E.q(3.4) can be carried out with all values of \(k_0, …, k_{l-2} \), and \( n_0, …, n_{m-l-1}\) simultaneously. In some applications it is convenient to use E.q(3.4) to express \(x_l\) in terms of \(x_{l-2}\), giving what is equivalent to an algorithm with \(r &#x3D; 4\).<br>the last array calculated gives the desired Fourier sums,</p>
<p>\[\tag{3.5}<br>X(k_{m-1}, …, k_0) &#x3D; x_{m}(k_0, …, k_{m-1})<br>\]<br>in such an order that the index of an X must have its binary bits put in reverse order to yield its index in the array \(x_m\)</p>
<h2 id="references"><a href="#references" class="headerlink" title="references"></a>references</h2><ul>
<li>[1] <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=MB6XGQWLV04">youtube video by Steve Brunton, Fourier Series</a></li>
<li>[2] <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Discrete_Fourier_transform">DFT wikipedia</a></li>
<li>[3] <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cooley%E2%80%93Tukey_FFT_algorithm">Cooley–Tukey FFT algorithm wikipedia</a></li>
<li>[4] <a target="_blank" rel="noopener" href="https://www.ams.org/journals/mcom/1965-19-090/S0025-5718-1965-0178586-1/S0025-5718-1965-0178586-1.pdf">1965, Cooley &amp; Turkey: an algorithm for the machine calculation of complex fourier series</a></li>
<li>[5] <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Split-radix_FFT_algorithm">Split-radix FFT algorithm wikipedia</a></li>
<li>[6] <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43870101/article/details/106095644?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_utm_term~default-2-106095644-blog-132357995.235%5Ev38%5Epc_relevant_sort_base1&spm=1001.2101.3001.4242.2&utm_relevant_index=5">csdn blog of FFT notes</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cliff0412.github.io/2023/10/12/math/fourier-series/" data-id="clokyy8dv0021qwsjhghcad7b" data-title="fourier series, DFT and FFT" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/math/" rel="tag">math</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/arithmatic/" rel="tag">arithmatic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blockchain/" rel="tag">blockchain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cargo/" rel="tag">cargo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cpp/" rel="tag">cpp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cryptography/" rel="tag">cryptography</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cuda/" rel="tag">cuda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ec/" rel="tag">ec</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ecdsa/" rel="tag">ecdsa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/geth/" rel="tag">geth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/" rel="tag">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/" rel="tag">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mpc/" rel="tag">mpc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/number-theory/" rel="tag">number_theory</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rust/" rel="tag">rust</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rust-crate/" rel="tag">rust-crate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rust-std/" rel="tag">rust-std</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/" rel="tag">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zkp/" rel="tag">zkp</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/arithmatic/" style="font-size: 11.25px;">arithmatic</a> <a href="/tags/blockchain/" style="font-size: 15px;">blockchain</a> <a href="/tags/cargo/" style="font-size: 10px;">cargo</a> <a href="/tags/cpp/" style="font-size: 13.75px;">cpp</a> <a href="/tags/cryptography/" style="font-size: 20px;">cryptography</a> <a href="/tags/cuda/" style="font-size: 12.5px;">cuda</a> <a href="/tags/ec/" style="font-size: 11.25px;">ec</a> <a href="/tags/ecdsa/" style="font-size: 10px;">ecdsa</a> <a href="/tags/geth/" style="font-size: 16.25px;">geth</a> <a href="/tags/golang/" style="font-size: 11.25px;">golang</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mpc/" style="font-size: 10px;">mpc</a> <a href="/tags/number-theory/" style="font-size: 10px;">number_theory</a> <a href="/tags/rust/" style="font-size: 18.75px;">rust</a> <a href="/tags/rust-crate/" style="font-size: 10px;">rust-crate</a> <a href="/tags/rust-std/" style="font-size: 13.75px;">rust-std</a> <a href="/tags/tool/" style="font-size: 10px;">tool</a> <a href="/tags/zkp/" style="font-size: 17.5px;">zkp</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/12/07/arithmatic/montgomery-multiplication/">montgomery multiplication</a>
          </li>
        
          <li>
            <a href="/2023/12/03/cryptography/zkp/kzg-commitment/">kzg polynomial commitment</a>
          </li>
        
          <li>
            <a href="/2023/12/01/cryptography/elliptic_curve/bls12-381/">bls12_381</a>
          </li>
        
          <li>
            <a href="/2023/11/24/cryptography/zkp/sgx_multi_prover/">sgx multi prover</a>
          </li>
        
          <li>
            <a href="/2023/11/24/cryptography/zkp/zk-bench/">zk bench</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 cliff<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>